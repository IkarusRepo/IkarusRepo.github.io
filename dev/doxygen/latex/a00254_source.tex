\hypertarget{a00254_source}{}\doxysection{invariantbased.\+hh}
\label{a00254_source}\index{invariantbased.hh@{invariantbased.hh}}
\mbox{\hyperlink{a00254}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2025 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00260}{ikarus/finiteelements/mechanics/materials/hyperelastic/deviatoric/deviatoricinvariants.hh}}>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00275}{ikarus/finiteelements/mechanics/materials/materialhelpers.hh}}>}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00233}{ikarus/finiteelements/mechanics/materials/tags.hh}}>}}
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00032}{ikarus/utils/tensorutils.hh}}>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00422}{Ikarus::Materials}} \{}
\DoxyCodeLine{18 }
\DoxyCodeLine{34 \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST\_, \textcolor{keywordtype}{int} n>}
\DoxyCodeLine{35 \textcolor{keyword}{struct }\mbox{\hyperlink{a01554}{InvariantBasedT}}}
\DoxyCodeLine{36 \{}
\DoxyCodeLine{37   \textcolor{keyword}{using }\mbox{\hyperlink{a01554_a2f41022c3ecb76eefb765015e643034b}{ScalarType}} = ST\_;}
\DoxyCodeLine{38 }
\DoxyCodeLine{39   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST = ScalarType>}
\DoxyCodeLine{40   \textcolor{keyword}{using }\mbox{\hyperlink{a01554_a24bdf403b337bf93cd310a915aba9aa8}{PrincipalStretches}} = Eigen::Vector<ST, 3>;}
\DoxyCodeLine{41   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST = ScalarType>}
\DoxyCodeLine{42   \textcolor{keyword}{using }\mbox{\hyperlink{a01554_a04794b6333cb664ebd7f10aa410aab01}{Invariants}} = \mbox{\hyperlink{a01554_a24bdf403b337bf93cd310a915aba9aa8}{PrincipalStretches<ST>}};}
\DoxyCodeLine{43 }
\DoxyCodeLine{44   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01554_a7f0b4300e1a4c2a05f9dc20f850f82d5}{dim}}              = 3;}
\DoxyCodeLine{45   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{int} \mbox{\hyperlink{a01554_a8252be6a2ad407fddf1abd0192b0eb52}{numMatParameters}} = n;}
\DoxyCodeLine{46 }
\DoxyCodeLine{47   \textcolor{keyword}{using }\mbox{\hyperlink{a01554_a3ceccb571b3cef82e4b9794452e010f5}{Exponents}}          = std::array<std::size\_t, numMatParameters>;}
\DoxyCodeLine{48   \textcolor{keyword}{using }\mbox{\hyperlink{a01554_a6e7eb1d8654cd930230685a6d3e34f96}{MaterialParameters}} = std::array<double, numMatParameters>;}
\DoxyCodeLine{49 }
\DoxyCodeLine{50   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST = ScalarType>}
\DoxyCodeLine{51   \textcolor{keyword}{using }\mbox{\hyperlink{a01554_a1a4692dc03aec1de5e9b41fa6ce5b9d4}{FirstDerivative}} = Eigen::Vector<ST, dim>;}
\DoxyCodeLine{52   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST = ScalarType>}
\DoxyCodeLine{53   \textcolor{keyword}{using }\mbox{\hyperlink{a01554_ab6be53b2765172f6f6e093919c5a061f}{SecondDerivative}} = Eigen::Matrix<ST, dim, dim>;}
\DoxyCodeLine{54 }
\DoxyCodeLine{55   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} \mbox{\hyperlink{a01554_a63e181f3b21504eaecdab7f03a0e3ac9}{stretchTag}} = \mbox{\hyperlink{a00411_aec3d3c4647af5c01e1bf18637b3c89feaae6dc167631992e1312a197d5c3c39f8}{PrincipalStretchTags::deviatoric}};}
\DoxyCodeLine{56 }
\DoxyCodeLine{57   [[nodiscard]] \textcolor{keyword}{constexpr} \textcolor{keyword}{static} std::string \mbox{\hyperlink{a01554_a4cc6a9ebdb6b1ec1cbbd4455734cc45f}{name}}() noexcept \{}
\DoxyCodeLine{58     \textcolor{keywordflow}{return} \textcolor{stringliteral}{"{}InvariantBased (n = "{}} + std::to\_string(\mbox{\hyperlink{a01554_a8252be6a2ad407fddf1abd0192b0eb52}{numMatParameters}});}
\DoxyCodeLine{59   \}}
\DoxyCodeLine{60 }
\DoxyCodeLine{61   \mbox{\hyperlink{a01554_a6e7eb1d8654cd930230685a6d3e34f96}{MaterialParameters}} \mbox{\hyperlink{a01554_afd36f592938bcdba49ef79e9d117eead}{materialParametersImpl}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} matParameters\_; \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63   \textcolor{keyword}{const} \mbox{\hyperlink{a01554_a3ceccb571b3cef82e4b9794452e010f5}{Exponents}}\& \mbox{\hyperlink{a01554_a67a85fc0ccd91330a3d72c4818db6899}{pExponents}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} pex\_; \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{65   \textcolor{keyword}{const} \mbox{\hyperlink{a01554_a3ceccb571b3cef82e4b9794452e010f5}{Exponents}}\& \mbox{\hyperlink{a01554_aa530b0b70ad6ed5290c574ddc38aa64c}{qExponents}}()\textcolor{keyword}{ const }\{ \textcolor{keywordflow}{return} qex\_; \}}
\DoxyCodeLine{66 }
\DoxyCodeLine{74   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01554_adbb74c7796046063299444ddfa56687f}{InvariantBasedT}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01554_a3ceccb571b3cef82e4b9794452e010f5}{Exponents}}\& pex, \textcolor{keyword}{const} \mbox{\hyperlink{a01554_a3ceccb571b3cef82e4b9794452e010f5}{Exponents}}\& qex, \textcolor{keyword}{const} \mbox{\hyperlink{a01554_a6e7eb1d8654cd930230685a6d3e34f96}{MaterialParameters}}\& matParameters)}
\DoxyCodeLine{75       : pex\_\{pex\},}
\DoxyCodeLine{76         qex\_\{qex\},}
\DoxyCodeLine{77         matParameters\_\{matParameters\} \{}
\DoxyCodeLine{78     checkExponents();}
\DoxyCodeLine{79   \}}
\DoxyCodeLine{80 }
\DoxyCodeLine{88   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST = ScalarType>}
\DoxyCodeLine{89   ST \mbox{\hyperlink{a01554_a7c30e46f59f3ca6088f671deea149e9b}{storedEnergyImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01554_a24bdf403b337bf93cd310a915aba9aa8}{PrincipalStretches<ST>}}\& lambda)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{90     \textcolor{keyword}{const} \mbox{\hyperlink{a01554_a04794b6333cb664ebd7f10aa410aab01}{Invariants<ST>}}\& invariants = Impl::invariants(lambda);}
\DoxyCodeLine{91     ST energy\{0.0\};}
\DoxyCodeLine{92     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& devInvariants = \mbox{\hyperlink{a01538}{DeviatoricInvariants<PrincipalStretches<ST>}}>(lambda);}
\DoxyCodeLine{93     \textcolor{keyword}{auto} [W1, W2]             = devInvariants.\mbox{\hyperlink{a01538_a9c016a61bba2d581b57c0f373a7f822c}{value}}();}
\DoxyCodeLine{94     W1 -\/= 3.0;}
\DoxyCodeLine{95     W2 -\/= 3.0;}
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} i : parameterRange())}
\DoxyCodeLine{98       energy += matParameters\_[i] * pow(W1, pex\_[i]) * pow(W2, qex\_[i]);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \textcolor{keywordflow}{return} energy;}
\DoxyCodeLine{101   \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{110   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST = ScalarType>}
\DoxyCodeLine{111   \mbox{\hyperlink{a01554_a1a4692dc03aec1de5e9b41fa6ce5b9d4}{FirstDerivative<ST>}} \mbox{\hyperlink{a01554_acb2acf8c8ce16263d806aa5206f413f3}{firstDerivativeImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01554_a24bdf403b337bf93cd310a915aba9aa8}{PrincipalStretches<ST>}}\& lambda)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{112     \textcolor{keyword}{const} \mbox{\hyperlink{a01554_a04794b6333cb664ebd7f10aa410aab01}{Invariants<ST>}}\& invariants = Impl::invariants(lambda);}
\DoxyCodeLine{113     \textcolor{keyword}{auto} dWdLambda                   = \mbox{\hyperlink{a01554_a1a4692dc03aec1de5e9b41fa6ce5b9d4}{FirstDerivative<ST>::Zero}}().eval();}
\DoxyCodeLine{114 }
\DoxyCodeLine{115     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& mu            = matParameters\_;}
\DoxyCodeLine{116     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& devInvariants = \mbox{\hyperlink{a01538}{DeviatoricInvariants<PrincipalStretches<ST>}}>(lambda);}
\DoxyCodeLine{117     \textcolor{keyword}{auto} [W1, W2]             = devInvariants.\mbox{\hyperlink{a01538_a9c016a61bba2d581b57c0f373a7f822c}{value}}();}
\DoxyCodeLine{118     W1 -\/= 3.0;}
\DoxyCodeLine{119     W2 -\/= 3.0;}
\DoxyCodeLine{120     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& [dW1dLambda, dW2dLambda] = devInvariants.\mbox{\hyperlink{a01538_a981e70dd52fc55dcd29e0bfe6507b214}{firstDerivative}}();}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} p : parameterRange())}
\DoxyCodeLine{123       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} k : dimensionRange()) \{}
\DoxyCodeLine{124         \textcolor{keyword}{auto} W1pm1p = powerAndMultiply<ST>(W1, pex\_[p] -\/ 1.0, pex\_[p]);}
\DoxyCodeLine{125         \textcolor{keyword}{auto} W2qm1q = powerAndMultiply<ST>(W2, qex\_[p] -\/ 1.0, qex\_[p]);}
\DoxyCodeLine{126         dWdLambda[k] +=}
\DoxyCodeLine{127             mu[p] * ((W1pm1p * pow(W2, qex\_[p]) * dW1dLambda[k]) + (pow(W1, pex\_[p]) * W2qm1q * dW2dLambda[k]));}
\DoxyCodeLine{128       \}}
\DoxyCodeLine{129 }
\DoxyCodeLine{130     \textcolor{keywordflow}{return} dWdLambda;}
\DoxyCodeLine{131   \}}
\DoxyCodeLine{132 }
\DoxyCodeLine{140   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST = ScalarType>}
\DoxyCodeLine{141   \mbox{\hyperlink{a01554_ab6be53b2765172f6f6e093919c5a061f}{SecondDerivative<ST>}} \mbox{\hyperlink{a01554_a0903a7458da8578488d14ff02cc00e2c}{secondDerivativeImpl}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01554_a24bdf403b337bf93cd310a915aba9aa8}{PrincipalStretches<ST>}}\& lambda)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{142     \textcolor{keyword}{const} \mbox{\hyperlink{a01554_a04794b6333cb664ebd7f10aa410aab01}{Invariants<ST>}}\& invariants = Impl::invariants(lambda);}
\DoxyCodeLine{143     \textcolor{keyword}{auto} dS                          = \mbox{\hyperlink{a01554_ab6be53b2765172f6f6e093919c5a061f}{SecondDerivative<ST>::Zero}}().eval();}
\DoxyCodeLine{144 }
\DoxyCodeLine{145     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& mu            = matParameters\_;}
\DoxyCodeLine{146     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& devInvariants = \mbox{\hyperlink{a01538}{DeviatoricInvariants<PrincipalStretches<ST>}}>(lambda);}
\DoxyCodeLine{147     \textcolor{keyword}{auto} [W1, W2]             = devInvariants.\mbox{\hyperlink{a01538_a9c016a61bba2d581b57c0f373a7f822c}{value}}();}
\DoxyCodeLine{148     W1 -\/= 3.0;}
\DoxyCodeLine{149     W2 -\/= 3.0;}
\DoxyCodeLine{150     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& [dW1dLambda, dW2dLambda]   = devInvariants.\mbox{\hyperlink{a01538_a981e70dd52fc55dcd29e0bfe6507b214}{firstDerivative}}();}
\DoxyCodeLine{151     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& [ddW1dLambda, ddW2dLambda] = devInvariants.secondDerivative();}
\DoxyCodeLine{152 }
\DoxyCodeLine{153     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} p : parameterRange())}
\DoxyCodeLine{154       \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} i : dimensionRange())}
\DoxyCodeLine{155         \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} j : dimensionRange()) \{}
\DoxyCodeLine{156           \textcolor{keyword}{auto} W1pm1p       = powerAndMultiply<ST>(W1, pex\_[p] -\/ 1.0, pex\_[p]);}
\DoxyCodeLine{157           \textcolor{keyword}{auto} W2qm1q       = powerAndMultiply<ST>(W2, qex\_[p] -\/ 1.0, qex\_[p]);}
\DoxyCodeLine{158           \textcolor{keyword}{auto} W1pm2pp      = powerAndMultiply<ST>(W1, pex\_[p] -\/ 2.0, pex\_[p] * (pex\_[p] -\/ 1.0));}
\DoxyCodeLine{159           \textcolor{keyword}{auto} W2qm2qq      = powerAndMultiply<ST>(W2, qex\_[p] -\/ 2.0, qex\_[p] * (qex\_[p] -\/ 1.0));}
\DoxyCodeLine{160           \textcolor{keyword}{auto} dW1W2dlambda = dW1dLambda[i] * dW2dLambda[j] + dW1dLambda[j] * dW2dLambda[i];}
\DoxyCodeLine{161           \textcolor{keyword}{auto} factor1      = (W2qm1q * dW1W2dlambda + pow(W2, qex\_[p]) * ddW1dLambda(i, j)) * W1pm1p * mu[p];}
\DoxyCodeLine{162           \textcolor{keyword}{auto} factor2      = W2qm1q * ddW2dLambda(i, j) * pow(W1, pex\_[p]) * mu[p];}
\DoxyCodeLine{163           \textcolor{keyword}{auto} factor3      = W1pm2pp * pow(W2, qex\_[p]) * dW1dLambda[i] * dW1dLambda[j] * mu[p];}
\DoxyCodeLine{164           \textcolor{keyword}{auto} factor4      = W2qm2qq * pow(W1, pex\_[p]) * dW2dLambda[i] * dW2dLambda[j] * mu[p];}
\DoxyCodeLine{165           dS(i, j) += factor1 + factor2 + factor3 + factor4;}
\DoxyCodeLine{166           \textcolor{keywordflow}{if} (i == j) \{}
\DoxyCodeLine{167             \textcolor{keyword}{auto} factor5 =}
\DoxyCodeLine{168                 mu[p] * (W1pm1p * pow(W2, qex\_[p]) * dW1dLambda[i] + pow(W1, pex\_[p]) * W2qm1q * dW2dLambda[i]);}
\DoxyCodeLine{169             dS(i, j) -\/= (1.0 / lambda[i]) * factor5;}
\DoxyCodeLine{170           \}}
\DoxyCodeLine{171         \}}
\DoxyCodeLine{172     \textcolor{keywordflow}{return} dS;}
\DoxyCodeLine{173   \}}
\DoxyCodeLine{174 }
\DoxyCodeLine{180   \textcolor{keyword}{template} <\textcolor{keyword}{typename} STO>}
\DoxyCodeLine{181   \textcolor{keyword}{auto} \mbox{\hyperlink{a01554_a81e57359abb85ae74a91a85b5c12a56c}{rebind}}()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{182     \textcolor{keywordflow}{return} \mbox{\hyperlink{a01554}{InvariantBasedT<STO, numMatParameters>}}(pex\_, qex\_, matParameters\_);}
\DoxyCodeLine{183   \}}
\DoxyCodeLine{184 }
\DoxyCodeLine{185 \textcolor{keyword}{private}:}
\DoxyCodeLine{186   \mbox{\hyperlink{a01554_a3ceccb571b3cef82e4b9794452e010f5}{Exponents}} pex\_, qex\_;}
\DoxyCodeLine{187   \mbox{\hyperlink{a01554_a6e7eb1d8654cd930230685a6d3e34f96}{MaterialParameters}} matParameters\_;}
\DoxyCodeLine{188 }
\DoxyCodeLine{189   \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} parameterRange() \{ \textcolor{keywordflow}{return} Dune::range(\mbox{\hyperlink{a01554_a8252be6a2ad407fddf1abd0192b0eb52}{numMatParameters}}); \}}
\DoxyCodeLine{190   \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keyword}{auto} dimensionRange() \{ \textcolor{keywordflow}{return} Dune::range(\mbox{\hyperlink{a01554_a7f0b4300e1a4c2a05f9dc20f850f82d5}{dim}}); \}}
\DoxyCodeLine{191 }
\DoxyCodeLine{206   \textcolor{keyword}{template} <\textcolor{keyword}{typename} ST>}
\DoxyCodeLine{207   ST powerAndMultiply(ST x, \textcolor{keywordtype}{int} p, \textcolor{keywordtype}{int} m)\textcolor{keyword}{ const }\{}
\DoxyCodeLine{208     \textcolor{keywordflow}{if} (m == 0)}
\DoxyCodeLine{209       \textcolor{keywordflow}{return} 0; \textcolor{comment}{// anything multiplied with 0 is 0}}
\DoxyCodeLine{210     \textcolor{keywordflow}{if} (p == 0)}
\DoxyCodeLine{211       \textcolor{keywordflow}{return} m; \textcolor{comment}{// x\string^0 * m = 1 * m = m}}
\DoxyCodeLine{212     \textcolor{keyword}{const} \textcolor{keywordtype}{double} epsilon = std::numeric\_limits<double>::epsilon();}
\DoxyCodeLine{213     assert(not(std::abs(x) < epsilon and p < 0) \&\& \textcolor{stringliteral}{"{}Raising zero to a negative power results in NaN."{}});}
\DoxyCodeLine{214     \textcolor{keywordflow}{return} std::pow(x, p) * m;}
\DoxyCodeLine{215   \}}
\DoxyCodeLine{216 }
\DoxyCodeLine{218   \textcolor{keywordtype}{void} checkExponents()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{219     \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto} i : parameterRange())}
\DoxyCodeLine{220       \textcolor{keywordflow}{if} (pex\_[i] == 0 and qex\_[i] == 0)}
\DoxyCodeLine{221         DUNE\_THROW(Dune::InvalidStateException, \textcolor{stringliteral}{"{}The exponent q"{}} + std::to\_string(i) + \textcolor{stringliteral}{"{}and the exponent p"{}} +}
\DoxyCodeLine{222                                                     std::to\_string(i) + \textcolor{stringliteral}{"{}should not be zero at the same time."{}});}
\DoxyCodeLine{223   \}}
\DoxyCodeLine{224 \};}
\DoxyCodeLine{225 }
\DoxyCodeLine{229 \textcolor{keyword}{template} <\textcolor{keywordtype}{int} n>}
\DoxyCodeLine{230 \textcolor{keyword}{using }\mbox{\hyperlink{a01554}{InvariantBased}} = \mbox{\hyperlink{a01554}{InvariantBasedT<double, n>}};}
\DoxyCodeLine{231 }
\DoxyCodeLine{232 \} \textcolor{comment}{// namespace Ikarus::Materials}}

\end{DoxyCode}
