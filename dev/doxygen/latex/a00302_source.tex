\hypertarget{a00302_source}{}\doxysection{trustregion.\+hh}
\label{a00302_source}\index{trustregion.hh@{trustregion.hh}}
\mbox{\hyperlink{a00302}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SPDX-\/FileCopyrightText: 2021-\/2024 The Ikarus Developers mueller@ibb.uni-\/stuttgart.de}}
\DoxyCodeLine{2 \textcolor{comment}{// SPDX-\/License-\/Identifier: LGPL-\/3.0-\/or-\/later}}
\DoxyCodeLine{3 }
\DoxyCodeLine{9 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <iosfwd>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <dune/common/float\_cmp.hh>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 \textcolor{preprocessor}{\#include <spdlog/spdlog.h>}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include <Eigen/Sparse>}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00299}{ikarus/linearalgebra/truncatedconjugategradient.hh}}>}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00311}{ikarus/solver/nonlinearsolver/solverinfos.hh}}>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00038}{ikarus/utils/defaultfunctions.hh}}>}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00056}{ikarus/utils/linearalgebrahelper.hh}}>}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00284}{ikarus/utils/observer/observer.hh}}>}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00287}{ikarus/utils/observer/observermessages.hh}}>}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{a00008}{ikarus/utils/traits.hh}}>}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{namespace }\mbox{\hyperlink{a00363}{Ikarus}} \{}
\DoxyCodeLine{28 }
\DoxyCodeLine{33 \textcolor{keyword}{enum class} \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66}{PreConditioner}}}
\DoxyCodeLine{34 \{}
\DoxyCodeLine{35   \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a7a24b184ba388b8e327feb98dbe168ff}{IncompleteCholesky}},}
\DoxyCodeLine{36   \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a7a93111b975ec3c3824eab230f3ec608}{IdentityPreconditioner}},}
\DoxyCodeLine{37   \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a3c6b5404db3b7bf45a0302f376a53afc}{DiagonalPreconditioner}}}
\DoxyCodeLine{38 \};}
\DoxyCodeLine{39 }
\DoxyCodeLine{40 \textcolor{keyword}{struct }\mbox{\hyperlink{a01632}{TRSettings}}}
\DoxyCodeLine{41 \{}
\DoxyCodeLine{42   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01632_a3b6b5fd328830b37cf47a8c3b485eb3e}{verbosity}}    = 5;                                       }
\DoxyCodeLine{43   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01632_a65731eb979e7677f54722743edebc4c7}{maxtime}}   = std::numeric\_limits<double>::infinity(); }
\DoxyCodeLine{44   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01632_a58ec4234ba537f77ccf56ef6ec5db526}{minIter}}      = 3;                                       }
\DoxyCodeLine{45   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01632_ac496e08f6fc420b641d2e838d4adbb53}{maxIter}}      = 1000;                                    }
\DoxyCodeLine{46   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01632_a509efb6f34d183fdff88f95fe21a97ea}{debug}}        = 0;                                       }
\DoxyCodeLine{47   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01632_a1cc69f38c3569c63cb4bf86a39a16050}{grad\_tol}}  = 1e-\/6;                                    }
\DoxyCodeLine{48   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01632_ab598fd07116bda4ec7ff4ec10ad771bb}{corr\_tol}}  = 1e-\/6;                                    }
\DoxyCodeLine{49   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01632_acf36d2743732832643df20a287a9ca91}{rho\_prime}} = 0.01;                                    }
\DoxyCodeLine{50   \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01632_a3943cb103ad51f2c407c867672dd3b1f}{useRand}}     = \textcolor{keyword}{false};                                   }
\DoxyCodeLine{51   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01632_a29358b818a3eabe94a0d75218225de0d}{rho\_reg}}   = 1e6;                                     }
\DoxyCodeLine{52   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01632_a275deb9273559ec6b6bae0e1a0650bd8}{Delta\_bar}} = std::numeric\_limits<double>::infinity(); }
\DoxyCodeLine{53   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01632_a2c36a30b640ce11ec533bd259d439bd5}{Delta0}}    = 10;                                      }
\DoxyCodeLine{54 \};}
\DoxyCodeLine{55 }
\DoxyCodeLine{61 \textcolor{keyword}{template} <PreConditioner preConditioner = PreConditioner::IncompleteCholesky, \textcolor{keyword}{typename} UF = utils::UpdateDefault>}
\DoxyCodeLine{62 \textcolor{keyword}{struct }\mbox{\hyperlink{a01636}{TrustRegionConfig}}}
\DoxyCodeLine{63 \{}
\DoxyCodeLine{64   \textcolor{keyword}{static\_assert}(std::copy\_constructible<UF>,}
\DoxyCodeLine{65                 \textcolor{stringliteral}{"{} The update function should be copy constructable. If it is a lambda wrap it in a std::function"{}});}
\DoxyCodeLine{66 }
\DoxyCodeLine{67   \textcolor{keyword}{using }\mbox{\hyperlink{a01636_a9719e786287c8d5aca05169048800ec3}{UpdateFunction}} = UF;}
\DoxyCodeLine{68 }
\DoxyCodeLine{69   \mbox{\hyperlink{a01632}{TRSettings}} \mbox{\hyperlink{a01636_a96af86c9e501d6f3c679f6e97cbec00f}{parameters}};}
\DoxyCodeLine{70   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66}{PreConditioner}} \mbox{\hyperlink{a01636_a1dec794b41865bc77a8971d7648acee9}{preConditionerType}} = preConditioner;}
\DoxyCodeLine{71   UF \mbox{\hyperlink{a01636_ab139b15888c191733475c91bebe0226c}{updateFunction}};}
\DoxyCodeLine{72   \textcolor{keyword}{template} <\textcolor{keyword}{typename} UF2>}
\DoxyCodeLine{73   \textcolor{keyword}{auto} \mbox{\hyperlink{a01636_adedaf2b065be442272056616d31c74d4}{rebindUpdateFunction}}(UF2\&\& \mbox{\hyperlink{a01636_ab139b15888c191733475c91bebe0226c}{updateFunction}})\textcolor{keyword}{ const }\{}
\DoxyCodeLine{74     \mbox{\hyperlink{a01636}{TrustRegionConfig<preConditioner, UF2>}} settings\{.\mbox{\hyperlink{a01636_a96af86c9e501d6f3c679f6e97cbec00f}{parameters}}     = \mbox{\hyperlink{a01636_a96af86c9e501d6f3c679f6e97cbec00f}{parameters}},}
\DoxyCodeLine{75                                                     .updateFunction = std::forward<UF2>(\mbox{\hyperlink{a01636_ab139b15888c191733475c91bebe0226c}{updateFunction}})\};}
\DoxyCodeLine{76     \textcolor{keywordflow}{return} settings;}
\DoxyCodeLine{77   \}}
\DoxyCodeLine{78 \};}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{keyword}{template} <\textcolor{keyword}{typename} NLO, \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66}{PreConditioner}} preConditioner = \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a7a24b184ba388b8e327feb98dbe168ff}{PreConditioner::IncompleteCholesky}},}
\DoxyCodeLine{81           \textcolor{keyword}{typename} UF = utils::UpdateDefault>}
\DoxyCodeLine{82 \textcolor{keyword}{class }\mbox{\hyperlink{a00363_a8d76e20d6a74e339f85d98c9854ee89c}{TrustRegion}};}
\DoxyCodeLine{83 }
\DoxyCodeLine{92 \textcolor{keyword}{template} <\textcolor{keyword}{typename} NLO, \textcolor{keyword}{typename} TRConfig>}
\DoxyCodeLine{93 \textcolor{keyword}{requires} traits::isSpecializationNonTypeAndTypes<TrustRegionConfig, std::remove\_cvref\_t<TRConfig>>::value}
\DoxyCodeLine{94 \textcolor{keyword}{auto} \mbox{\hyperlink{a00363_a66b45c139b5d57965ada53d92d8f93ce}{createNonlinearSolver}}(TRConfig\&\& config, NLO\&\& nonLinearOperator) \{}
\DoxyCodeLine{95   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66}{PreConditioner}} preConditioner = std::remove\_cvref\_t<TRConfig>::preConditionerType;}
\DoxyCodeLine{96   \textcolor{keyword}{using }UF                                       = std::remove\_cvref\_t<TRConfig>::UpdateFunction;}
\DoxyCodeLine{97   \textcolor{keyword}{static\_assert}(std::remove\_cvref\_t<NLO>::numberOfFunctions == 3,}
\DoxyCodeLine{98                 \textcolor{stringliteral}{"{}The number of derivatives in the nonlinear operator have to be exactly 3."{}});}
\DoxyCodeLine{99   \textcolor{keyword}{auto} solver = std::make\_shared<TrustRegion<NLO, preConditioner, UF>>(nonLinearOperator,}
\DoxyCodeLine{100                                                                        std::forward<TRConfig>(config).updateFunction);}
\DoxyCodeLine{101 }
\DoxyCodeLine{102   solver-\/>setup(config.parameters);}
\DoxyCodeLine{103   \textcolor{keywordflow}{return} solver;}
\DoxyCodeLine{104 \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{110 \textcolor{keyword}{enum class} \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674}{StopReason}}}
\DoxyCodeLine{111 \{}
\DoxyCodeLine{112   \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674a0c4f44592a7ae85baf42cb3fb4a5a3d1}{gradientNormTolReached}},}
\DoxyCodeLine{113   \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674ad1c6a6016de417acc66b5ac44a1fdca3}{correctionNormTolReached}},}
\DoxyCodeLine{114   \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674ad205528fe2a4412b89626ff7eee936f9}{maximumTimeReached}},}
\DoxyCodeLine{115   \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674a5ed07f9461b91dd3a6ba961a0ed5c8fe}{maximumIterationsReached}},}
\DoxyCodeLine{116   \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674a8d2fa9685be8b8f8994bd8a73bfa8c9f}{dontStop}}}
\DoxyCodeLine{117 \};}
\DoxyCodeLine{118 }
\DoxyCodeLine{123 \textcolor{keyword}{struct }\mbox{\hyperlink{a01644}{AlgoInfo}}}
\DoxyCodeLine{124 \{}
\DoxyCodeLine{125   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01644_afc288b38be6c8627cf079d9bffc3cda9}{consecutive\_TRplus}}   = 0;                 }
\DoxyCodeLine{126   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01644_aab1636ca718e535e09e61cdefc348084}{consecutive\_TRminus}}  = 0;                 }
\DoxyCodeLine{127   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01644_ae1f58001cb449db18bdbd98740dd143d}{consecutive\_Rejected}} = 0;                 }
\DoxyCodeLine{128   std::string \mbox{\hyperlink{a01644_af34cb5bb79e983db99b959d871afd353}{stopReasonString}};                 }
\DoxyCodeLine{129   std::string \mbox{\hyperlink{a01644_ae987404091035ade31e839e9f00b7cbd}{trstr}};                            }
\DoxyCodeLine{130   std::string \mbox{\hyperlink{a01644_af3d423f3f05e0bdd445e2b9de7dc9daf}{accstr}};                           }
\DoxyCodeLine{131   std::string \mbox{\hyperlink{a01644_a84be03aa6ebbd80ab2e6fac5a78aacd3}{randomPredictionString}};           }
\DoxyCodeLine{132   std::string \mbox{\hyperlink{a01644_a3947b27f29bf44beb7f3f19e91c344f9}{cauchystr}} = \textcolor{stringliteral}{"{}                  "{}}; }
\DoxyCodeLine{133   \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01644_a8c3abc0958c354cc92394dfd12a0317b}{acceptProposal}};                          }
\DoxyCodeLine{134   \textcolor{keywordtype}{bool} \mbox{\hyperlink{a01644_ac6037dd6d1303ded090d9da71dea06b9}{used\_cauchy}} = \textcolor{keyword}{false};                     }
\DoxyCodeLine{135   \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674}{StopReason}} \mbox{\hyperlink{a01644_a68f203529fcd8a947fd49330a83d42b2}{stop}}\{\mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674a8d2fa9685be8b8f8994bd8a73bfa8c9f}{StopReason::dontStop}}\};        }
\DoxyCodeLine{136   std::string \mbox{\hyperlink{a01644_a8df37485a1fdbbce8d153a8fadd537bf}{reasonString}};                     }
\DoxyCodeLine{137 \};}
\DoxyCodeLine{138 }
\DoxyCodeLine{143 \textcolor{keyword}{struct }\mbox{\hyperlink{a01648}{Stats}}}
\DoxyCodeLine{144 \{}
\DoxyCodeLine{145   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}}\{1\};}
\DoxyCodeLine{146   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}}\{1\};}
\DoxyCodeLine{147   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01648_ab3cab6865c16d06ec81b5db14b0dc5e2}{time}}\{0\};}
\DoxyCodeLine{148   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}}\{0\};}
\DoxyCodeLine{149   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}}\{0\};}
\DoxyCodeLine{150   \textcolor{keywordtype}{double} \mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}}\{0\};}
\DoxyCodeLine{151   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}}\{0\};}
\DoxyCodeLine{152   \textcolor{keywordtype}{int} \mbox{\hyperlink{a01648_ac5053b65db9ceae8340aaebe952c7792}{innerIterSum}}\{0\};}
\DoxyCodeLine{153 \};}
\DoxyCodeLine{154 }
\DoxyCodeLine{167 \textcolor{keyword}{template} <\textcolor{keyword}{typename} NLO, PreConditioner preConditioner, \textcolor{keyword}{typename} UF>}
\DoxyCodeLine{168 \textcolor{keyword}{class }\mbox{\hyperlink{a01640}{TrustRegion}} : \textcolor{keyword}{public} \mbox{\hyperlink{a01788}{IObservable}}<NonLinearSolverMessages>}
\DoxyCodeLine{169 \{}
\DoxyCodeLine{170 \textcolor{keyword}{public}:}
\DoxyCodeLine{171   \textcolor{keyword}{using }\mbox{\hyperlink{a01632}{Settings}}  = \mbox{\hyperlink{a01632}{TRSettings}};                               }
\DoxyCodeLine{172   \textcolor{keyword}{using }\mbox{\hyperlink{a01640_a44fa96b7ca63e50d8ed3707b4129369b}{ValueType}} = \textcolor{keyword}{typename} NLO::template ParameterValue<0>; }
\DoxyCodeLine{174   \textcolor{keyword}{using }\mbox{\hyperlink{a01640_a1071054a0b75f9fbe27832ea672792b0}{CorrectionType}} = \textcolor{keyword}{typename} NLO::DerivativeType;        }
\DoxyCodeLine{175   \textcolor{keyword}{using }\mbox{\hyperlink{a01640_a7f187a825b0a65e7d9ab1c21578da1cf}{UpdateFunction}} = UF;                                  }
\DoxyCodeLine{176 }
\DoxyCodeLine{177   \textcolor{keyword}{using }\mbox{\hyperlink{a01640_a7334271a9133e2503f142decf6ecebb7}{NonLinearOperator}} = NLO; }
\DoxyCodeLine{178 }
\DoxyCodeLine{179   \textcolor{keyword}{using }\mbox{\hyperlink{a01640_a34bb35f72b19375a57329d3fec82515c}{ScalarType}} = std::remove\_cvref\_t<typename NLO::template FunctionReturnType<0>>; }
\DoxyCodeLine{181 }
\DoxyCodeLine{182   \textcolor{keyword}{using }\mbox{\hyperlink{a01640_a631486c0b90c8a1a0bfc9d80694f6a4f}{MatrixType}} = std::remove\_cvref\_t<typename NLO::template FunctionReturnType<2>>; }
\DoxyCodeLine{183 }
\DoxyCodeLine{189   \textcolor{keyword}{template} <\textcolor{keyword}{typename} UF2 = UF>}
\DoxyCodeLine{190   \textcolor{keyword}{explicit} \mbox{\hyperlink{a01640_ae83eadc3a30071ec2c469cbc7f4c0c71}{TrustRegion}}(\textcolor{keyword}{const} NLO\& \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}, UF2\&\& updateFunction = \{\})}
\DoxyCodeLine{191       : nonLinearOperator\_\{\mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}\},}
\DoxyCodeLine{192         updateFunction\_\{std::forward<UF2>(updateFunction)\},}
\DoxyCodeLine{193         xOld\_\{this-\/>\mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().firstParameter()\} \{}
\DoxyCodeLine{194     eta\_.setZero(gradient().size());}
\DoxyCodeLine{195     Heta\_.setZero(gradient().size());}
\DoxyCodeLine{196     truncatedConjugateGradient\_.analyzePattern(hessian());}
\DoxyCodeLine{197   \}}
\DoxyCodeLine{198 }
\DoxyCodeLine{203   \textcolor{keywordtype}{void} \mbox{\hyperlink{a01640_a3e50d3a955e7e27019a1322969ec268e}{setup}}(\textcolor{keyword}{const} \mbox{\hyperlink{a01632}{Settings}}\& settings) \{}
\DoxyCodeLine{204     settings\_ = settings;}
\DoxyCodeLine{205     assert(settings\_.\mbox{\hyperlink{a01632_acf36d2743732832643df20a287a9ca91}{rho\_prime}} < 0.25 \&\& \textcolor{stringliteral}{"{}options.rho\_prime must be strictly smaller than 1/4."{}});}
\DoxyCodeLine{206     assert(settings\_.\mbox{\hyperlink{a01632_a275deb9273559ec6b6bae0e1a0650bd8}{Delta\_bar}} > 0 \&\& \textcolor{stringliteral}{"{}options.Delta\_bar must be positive."{}});}
\DoxyCodeLine{207     assert(settings\_.\mbox{\hyperlink{a01632_a2c36a30b640ce11ec533bd259d439bd5}{Delta0}} > 0 \&\& settings\_.\mbox{\hyperlink{a01632_a2c36a30b640ce11ec533bd259d439bd5}{Delta0}} < settings\_.\mbox{\hyperlink{a01632_a275deb9273559ec6b6bae0e1a0650bd8}{Delta\_bar}} \&\&}
\DoxyCodeLine{208            \textcolor{stringliteral}{"{}options.Delta0 must be positive and smaller than Delta\_bar."{}});}
\DoxyCodeLine{209   \}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211 \textcolor{preprocessor}{\#ifndef DOXYGEN}}
\DoxyCodeLine{212   \textcolor{keyword}{struct }NoPredictor}
\DoxyCodeLine{213   \{}
\DoxyCodeLine{214   \};}
\DoxyCodeLine{215 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{222   \textcolor{keyword}{template} <\textcolor{keyword}{typename} SolutionType = NoPredictor>}
\DoxyCodeLine{223   \textcolor{keyword}{requires} std::is\_same\_v<SolutionType, NoPredictor> || std::is\_convertible\_v<SolutionType, CorrectionType>}
\DoxyCodeLine{224   \mbox{\hyperlink{a01628}{NonLinearSolverInformation}} \mbox{\hyperlink{a01640_af244b67329c3aab4aa81f37c9eabae8f}{solve}}(\textcolor{keyword}{const} SolutionType\& dxPredictor = NoPredictor\{\}) \{}
\DoxyCodeLine{225     this-\/>\mbox{\hyperlink{a01788_a4bce3750aa7d52aff9baf122a54e16b5}{notify}}(\mbox{\hyperlink{a00357_gga662b2b6a80547adf4b9ce8b30d87fab5afaee4ca3c30ee18148ce3ada37466498}{NonLinearSolverMessages::INIT}});}
\DoxyCodeLine{226     stats\_ = \mbox{\hyperlink{a01648}{Stats}}\{\};}
\DoxyCodeLine{227     info\_  = AlgoInfo\{\};}
\DoxyCodeLine{228 }
\DoxyCodeLine{229     NonLinearSolverInformation solverInformation;}
\DoxyCodeLine{230     \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().updateAll();}
\DoxyCodeLine{231     stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}}   = energy();}
\DoxyCodeLine{232     \textcolor{keyword}{auto}\& x         = \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().firstParameter();}
\DoxyCodeLine{233     xOld\_           = x;}
\DoxyCodeLine{234     stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}} = \mbox{\hyperlink{a00358_ga0ffc0c74dbd9aeee3e53b199a21b828c}{norm}}(gradient());}
\DoxyCodeLine{235     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (not std::is\_same\_v<SolutionType, NoPredictor>)}
\DoxyCodeLine{236       updateFunction(x, dxPredictor);}
\DoxyCodeLine{237     truncatedConjugateGradient\_.analyzePattern(hessian());}
\DoxyCodeLine{238 }
\DoxyCodeLine{239     innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} = settings\_.\mbox{\hyperlink{a01632_a2c36a30b640ce11ec533bd259d439bd5}{Delta0}};}
\DoxyCodeLine{240     spdlog::info(}
\DoxyCodeLine{241         \textcolor{stringliteral}{"{}        | iter | inner\_i |   rho |   energy | energy\_p | energy\_inc |  norm(g) |    Delta | norm(corr) | "{}}}
\DoxyCodeLine{242         \textcolor{stringliteral}{"{}InnerBreakReason"{}});}
\DoxyCodeLine{243     spdlog::info(\textcolor{stringliteral}{"{}\{:-\/\string^143\}"{}}, \textcolor{stringliteral}{"{}-\/"{}});}
\DoxyCodeLine{244     \textcolor{keywordflow}{while} (not stoppingCriterion()) \{}
\DoxyCodeLine{245       this-\/>\mbox{\hyperlink{a01788_a4bce3750aa7d52aff9baf122a54e16b5}{notify}}(\mbox{\hyperlink{a00357_gga662b2b6a80547adf4b9ce8b30d87fab5afdb2cb9832d112cd92fb2cda8879c3b4}{NonLinearSolverMessages::ITERATION\_STARTED}});}
\DoxyCodeLine{246       \textcolor{keywordflow}{if} (settings\_.\mbox{\hyperlink{a01632_a3943cb103ad51f2c407c867672dd3b1f}{useRand}}) \{}
\DoxyCodeLine{247         \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}} == 0) \{}
\DoxyCodeLine{248           eta\_.setRandom();}
\DoxyCodeLine{249           \textcolor{keywordflow}{while} (eta\_.dot(hessian() * eta\_) > innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} * innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}})}
\DoxyCodeLine{250             eta\_ *= eps\_; \textcolor{comment}{// eps is sqrt(sqrt(maschine-\/precision))}}
\DoxyCodeLine{251         \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{252           eta\_.setZero();}
\DoxyCodeLine{253       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{254         eta\_.setZero();}
\DoxyCodeLine{255 }
\DoxyCodeLine{256       solveInnerProblem();}
\DoxyCodeLine{257       stats\_.\mbox{\hyperlink{a01648_ac5053b65db9ceae8340aaebe952c7792}{innerIterSum}} += innerInfo\_.\mbox{\hyperlink{a01568_aea7d60a8e86f8c8a17251b1da948ea68}{numInnerIter}};}
\DoxyCodeLine{258 }
\DoxyCodeLine{259       info\_.\mbox{\hyperlink{a01644_af34cb5bb79e983db99b959d871afd353}{stopReasonString}} = tcg\_stop\_reason\_[\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(innerInfo\_.\mbox{\hyperlink{a01568_a9c7c8b39cd33322b4ce22154628f4b7e}{stop\_tCG}})];}
\DoxyCodeLine{260       Heta\_                  = hessian() * eta\_;}
\DoxyCodeLine{261       \textcolor{keywordflow}{if} (settings\_.\mbox{\hyperlink{a01632_a3943cb103ad51f2c407c867672dd3b1f}{useRand}} and stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}} == 0) \{}
\DoxyCodeLine{262         info\_.\mbox{\hyperlink{a01644_ac6037dd6d1303ded090d9da71dea06b9}{used\_cauchy}}            = \textcolor{keyword}{false};}
\DoxyCodeLine{263         info\_.\mbox{\hyperlink{a01644_a84be03aa6ebbd80ab2e6fac5a78aacd3}{randomPredictionString}} = \textcolor{stringliteral}{"{} Used Random correction predictor"{}};}
\DoxyCodeLine{264         info\_.\mbox{\hyperlink{a01644_a3947b27f29bf44beb7f3f19e91c344f9}{cauchystr}}              = \textcolor{stringliteral}{"{}                  "{}};}
\DoxyCodeLine{265         \textcolor{keywordtype}{double} tauC;}
\DoxyCodeLine{266         \textcolor{comment}{// Check the curvature}}
\DoxyCodeLine{267         \textcolor{keyword}{const} Eigen::VectorXd Hg = hessian() * gradient();}
\DoxyCodeLine{268         \textcolor{keyword}{const} \textcolor{keyword}{auto} g\_Hg          = (gradient().dot(Hg));}
\DoxyCodeLine{269         \textcolor{keywordflow}{if} (g\_Hg <= 0)}
\DoxyCodeLine{270           tauC = 1;}
\DoxyCodeLine{271         \textcolor{keywordflow}{else}}
\DoxyCodeLine{272           tauC = std::min(Dune::power(stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}}, 3) / (innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} * g\_Hg), 1.0);}
\DoxyCodeLine{273 }
\DoxyCodeLine{274         \textcolor{comment}{// generate the Cauchy point.}}
\DoxyCodeLine{275         \textcolor{keyword}{const} Eigen::VectorXd etaC  = -\/tauC * innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} / stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}} * gradient();}
\DoxyCodeLine{276         \textcolor{keyword}{const} Eigen::VectorXd HetaC = -\/tauC * innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} / stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}} * Hg;}
\DoxyCodeLine{277 }
\DoxyCodeLine{278         \textcolor{keyword}{const} \textcolor{keywordtype}{double} mdle  = stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}} + gradient().dot(eta\_) + .5 * Heta\_.dot(eta\_);}
\DoxyCodeLine{279         \textcolor{keyword}{const} \textcolor{keywordtype}{double} mdlec = stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}} + gradient().dot(etaC) + .5 * HetaC.dot(etaC);}
\DoxyCodeLine{280         \textcolor{keywordflow}{if} (mdlec < mdle \&\& stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}} == 0) \{}
\DoxyCodeLine{281           eta\_              = etaC;}
\DoxyCodeLine{282           Heta\_             = HetaC;}
\DoxyCodeLine{283           info\_.\mbox{\hyperlink{a01644_ac6037dd6d1303ded090d9da71dea06b9}{used\_cauchy}} = \textcolor{keyword}{true};}
\DoxyCodeLine{284 }
\DoxyCodeLine{285           info\_.\mbox{\hyperlink{a01644_a3947b27f29bf44beb7f3f19e91c344f9}{cauchystr}} = \textcolor{stringliteral}{"{} USED CAUCHY POINT!"{}};}
\DoxyCodeLine{286         \}}
\DoxyCodeLine{287       \} \textcolor{keywordflow}{else}}
\DoxyCodeLine{288         info\_.\mbox{\hyperlink{a01644_a3947b27f29bf44beb7f3f19e91c344f9}{cauchystr}} = \textcolor{stringliteral}{"{}                  "{}};}
\DoxyCodeLine{289 }
\DoxyCodeLine{290       stats\_.\mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}} = eta\_.norm();}
\DoxyCodeLine{291 }
\DoxyCodeLine{292       updateFunction\_(x, eta\_);}
\DoxyCodeLine{293 }
\DoxyCodeLine{294       \textcolor{comment}{// Calculate energy of our proposed update step}}
\DoxyCodeLine{295       \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().template update<0>();}
\DoxyCodeLine{296       stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}} = energy();}
\DoxyCodeLine{297 }
\DoxyCodeLine{298       \textcolor{comment}{// Will we accept the proposal or not?}}
\DoxyCodeLine{299       \textcolor{comment}{// Check the performance of the quadratic model against the actual energy.}}
\DoxyCodeLine{300       \textcolor{keyword}{auto} rhonum = stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}} -\/ stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}};}
\DoxyCodeLine{301       \textcolor{keyword}{auto} rhoden = -\/eta\_.dot(gradient() + 0.5 * Heta\_);}
\DoxyCodeLine{302 }
\DoxyCodeLine{303       \textcolor{comment}{/*  Close to convergence the proposed energy and the real energy almost coincide.}}
\DoxyCodeLine{304 \textcolor{comment}{       *  Therefore, the performance check of our model becomes ill-\/conditioned}}
\DoxyCodeLine{305 \textcolor{comment}{       *  The regularisation fixes this */}}
\DoxyCodeLine{306       \textcolor{keyword}{const} \textcolor{keyword}{auto} rhoReg = std::max(1.0, abs(stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}})) * eps\_ * settings\_.\mbox{\hyperlink{a01632_a29358b818a3eabe94a0d75218225de0d}{rho\_reg}};}
\DoxyCodeLine{307       rhonum            = rhonum + rhoReg;}
\DoxyCodeLine{308       rhoden            = rhoden + rhoReg;}
\DoxyCodeLine{309 }
\DoxyCodeLine{310       \textcolor{keyword}{const} \textcolor{keywordtype}{bool} modelDecreased = rhoden > 0.0;}
\DoxyCodeLine{311 }
\DoxyCodeLine{312       \textcolor{keywordflow}{if} (!modelDecreased)}
\DoxyCodeLine{313         info\_.\mbox{\hyperlink{a01644_af34cb5bb79e983db99b959d871afd353}{stopReasonString}}.append(\textcolor{stringliteral}{"{}, model did not decrease"{}});}
\DoxyCodeLine{314 }
\DoxyCodeLine{315       stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}} = rhonum / rhoden;}
\DoxyCodeLine{316       stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}} = stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}} < 0.0 ? -\/1.0 : stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}}; \textcolor{comment}{// move rho to the domain [-\/1.0,inf]}}
\DoxyCodeLine{317 }
\DoxyCodeLine{318       info\_.\mbox{\hyperlink{a01644_ae987404091035ade31e839e9f00b7cbd}{trstr}} = \textcolor{stringliteral}{"{}   "{}};}
\DoxyCodeLine{319 }
\DoxyCodeLine{320       \textcolor{comment}{// measure if energy decreased}}
\DoxyCodeLine{321       \textcolor{keyword}{const} \textcolor{keywordtype}{bool} energyDecreased = Dune::FloatCmp::ge(stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}} -\/ stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}}, -\/1e-\/12);}
\DoxyCodeLine{322 }
\DoxyCodeLine{323       \textcolor{comment}{// If the model behaves badly or if the energy increased we reduce the trust region size}}
\DoxyCodeLine{324       \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}} < 1e-\/4 || not modelDecreased || std::isnan(stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}}) || not energyDecreased) \{}
\DoxyCodeLine{325         info\_.\mbox{\hyperlink{a01644_ae987404091035ade31e839e9f00b7cbd}{trstr}} = \textcolor{stringliteral}{"{}TR-\/"{}};}
\DoxyCodeLine{326         innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} /= 4.0;}
\DoxyCodeLine{327         info\_.\mbox{\hyperlink{a01644_afc288b38be6c8627cf079d9bffc3cda9}{consecutive\_TRplus}} = 0;}
\DoxyCodeLine{328         info\_.\mbox{\hyperlink{a01644_aab1636ca718e535e09e61cdefc348084}{consecutive\_TRminus}}++;}
\DoxyCodeLine{329         \textcolor{keywordflow}{if} (info\_.\mbox{\hyperlink{a01644_aab1636ca718e535e09e61cdefc348084}{consecutive\_TRminus}} >= 5 \&\& settings\_.\mbox{\hyperlink{a01632_a3b6b5fd328830b37cf47a8c3b485eb3e}{verbosity}} >= 1) \{}
\DoxyCodeLine{330           info\_.\mbox{\hyperlink{a01644_aab1636ca718e535e09e61cdefc348084}{consecutive\_TRminus}} = -\/std::numeric\_limits<int>::infinity();}
\DoxyCodeLine{331           spdlog::info(\textcolor{stringliteral}{"{} +++ Detected many consecutive TR-\/ (radius decreases)."{}});}
\DoxyCodeLine{332           spdlog::info(\textcolor{stringliteral}{"{} +++ Consider decreasing options.Delta\_bar by an order of magnitude."{}});}
\DoxyCodeLine{333         \}}
\DoxyCodeLine{334 }
\DoxyCodeLine{335       \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}} > 0.99 \&\& (innerInfo\_.\mbox{\hyperlink{a01568_a9c7c8b39cd33322b4ce22154628f4b7e}{stop\_tCG}} == \mbox{\hyperlink{a00373_a99c0436bed03f4dd4168a21f6b69ad5aa09116173dd03279374ae42ad40f940ba}{Eigen::TCGStopReason::negativeCurvature}} ||}
\DoxyCodeLine{336                                        innerInfo\_.\mbox{\hyperlink{a01568_a9c7c8b39cd33322b4ce22154628f4b7e}{stop\_tCG}} == \mbox{\hyperlink{a00373_a99c0436bed03f4dd4168a21f6b69ad5aa9e095c14131d90a6c10c08cd802c8aed}{Eigen::TCGStopReason::exceededTrustRegion}})) \{}
\DoxyCodeLine{337         info\_.\mbox{\hyperlink{a01644_ae987404091035ade31e839e9f00b7cbd}{trstr}}               = \textcolor{stringliteral}{"{}TR+"{}};}
\DoxyCodeLine{338         innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}}          = std::min(3.5 * innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}}, settings\_.\mbox{\hyperlink{a01632_a275deb9273559ec6b6bae0e1a0650bd8}{Delta\_bar}});}
\DoxyCodeLine{339         info\_.\mbox{\hyperlink{a01644_aab1636ca718e535e09e61cdefc348084}{consecutive\_TRminus}} = 0;}
\DoxyCodeLine{340         info\_.\mbox{\hyperlink{a01644_afc288b38be6c8627cf079d9bffc3cda9}{consecutive\_TRplus}}++;}
\DoxyCodeLine{341         \textcolor{keywordflow}{if} (info\_.\mbox{\hyperlink{a01644_afc288b38be6c8627cf079d9bffc3cda9}{consecutive\_TRplus}} >= 5 \&\& settings\_.\mbox{\hyperlink{a01632_a3b6b5fd328830b37cf47a8c3b485eb3e}{verbosity}} >= 1) \{}
\DoxyCodeLine{342           info\_.\mbox{\hyperlink{a01644_afc288b38be6c8627cf079d9bffc3cda9}{consecutive\_TRplus}} = -\/std::numeric\_limits<int>::infinity();}
\DoxyCodeLine{343           spdlog::info(\textcolor{stringliteral}{"{} +++ Detected many consecutive TR+ (radius increases)"{}});}
\DoxyCodeLine{344           spdlog::info(\textcolor{stringliteral}{"{} +++ Consider increasing options.Delta\_bar by an order of magnitude"{}});}
\DoxyCodeLine{345 }
\DoxyCodeLine{346         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{347           info\_.\mbox{\hyperlink{a01644_afc288b38be6c8627cf079d9bffc3cda9}{consecutive\_TRplus}}  = 0;}
\DoxyCodeLine{348           info\_.\mbox{\hyperlink{a01644_aab1636ca718e535e09e61cdefc348084}{consecutive\_TRminus}} = 0;}
\DoxyCodeLine{349         \}}
\DoxyCodeLine{350       \}}
\DoxyCodeLine{351 }
\DoxyCodeLine{352       \textcolor{keywordflow}{if} (modelDecreased \&\& stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}} > settings\_.\mbox{\hyperlink{a01632_acf36d2743732832643df20a287a9ca91}{rho\_prime}} \&\& energyDecreased) \{}
\DoxyCodeLine{353         \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}} > stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}})}
\DoxyCodeLine{354           spdlog::info(}
\DoxyCodeLine{355               \textcolor{stringliteral}{"{}Energy function increased by \{\} (step size: \{\}). Since this is small we accept the step and hope for "{}}}
\DoxyCodeLine{356               \textcolor{stringliteral}{"{}convergence of the gradient norm."{}},}
\DoxyCodeLine{357               stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}} -\/ stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}}, stats\_.\mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}});}
\DoxyCodeLine{358 }
\DoxyCodeLine{359         info\_.\mbox{\hyperlink{a01644_a8c3abc0958c354cc92394dfd12a0317b}{acceptProposal}}       = \textcolor{keyword}{true};}
\DoxyCodeLine{360         info\_.\mbox{\hyperlink{a01644_af3d423f3f05e0bdd445e2b9de7dc9daf}{accstr}}               = \textcolor{stringliteral}{"{}acc"{}};}
\DoxyCodeLine{361         info\_.\mbox{\hyperlink{a01644_ae1f58001cb449db18bdbd98740dd143d}{consecutive\_Rejected}} = 0;}
\DoxyCodeLine{362       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{363         info\_.\mbox{\hyperlink{a01644_a8c3abc0958c354cc92394dfd12a0317b}{acceptProposal}} = \textcolor{keyword}{false};}
\DoxyCodeLine{364         info\_.\mbox{\hyperlink{a01644_af3d423f3f05e0bdd445e2b9de7dc9daf}{accstr}}         = \textcolor{stringliteral}{"{}REJ"{}};}
\DoxyCodeLine{365 }
\DoxyCodeLine{366         \textcolor{keywordflow}{if} (info\_.\mbox{\hyperlink{a01644_ae1f58001cb449db18bdbd98740dd143d}{consecutive\_Rejected}} >= 5)}
\DoxyCodeLine{367           innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} /= 2;}
\DoxyCodeLine{368         \textcolor{keywordflow}{else}}
\DoxyCodeLine{369           innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}} = std::min(innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}}, stats\_.\mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}} / 2.0);}
\DoxyCodeLine{370         ++info\_.\mbox{\hyperlink{a01644_ae1f58001cb449db18bdbd98740dd143d}{consecutive\_Rejected}};}
\DoxyCodeLine{371       \}}
\DoxyCodeLine{372 }
\DoxyCodeLine{373       stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}}++;}
\DoxyCodeLine{374 }
\DoxyCodeLine{375       \textcolor{keywordflow}{if} (settings\_.\mbox{\hyperlink{a01632_a3b6b5fd328830b37cf47a8c3b485eb3e}{verbosity}} == 1)}
\DoxyCodeLine{376         logState();}
\DoxyCodeLine{377 }
\DoxyCodeLine{378       info\_.\mbox{\hyperlink{a01644_a84be03aa6ebbd80ab2e6fac5a78aacd3}{randomPredictionString}} = \textcolor{stringliteral}{"{}"{}};}
\DoxyCodeLine{379 }
\DoxyCodeLine{380       \textcolor{keywordflow}{if} (info\_.\mbox{\hyperlink{a01644_a8c3abc0958c354cc92394dfd12a0317b}{acceptProposal}}) \{}
\DoxyCodeLine{381         stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}} = stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}};}
\DoxyCodeLine{382         nonLinearOperator\_.updateAll();}
\DoxyCodeLine{383         xOld\_ = x;}
\DoxyCodeLine{384         this-\/>\mbox{\hyperlink{a01788_a4bce3750aa7d52aff9baf122a54e16b5}{notify}}(\mbox{\hyperlink{a00357_gga662b2b6a80547adf4b9ce8b30d87fab5a07a63a77745ab72a7e89fb22a8bcfd78}{NonLinearSolverMessages::CORRECTIONNORM\_UPDATED}}, stats\_.\mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}});}
\DoxyCodeLine{385         this-\/>\mbox{\hyperlink{a01788_a4bce3750aa7d52aff9baf122a54e16b5}{notify}}(\mbox{\hyperlink{a00357_gga662b2b6a80547adf4b9ce8b30d87fab5a721c68980ba6c47122945477a56d7a14}{NonLinearSolverMessages::RESIDUALNORM\_UPDATED}}, stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}});}
\DoxyCodeLine{386         this-\/>\mbox{\hyperlink{a01788_a4bce3750aa7d52aff9baf122a54e16b5}{notify}}(\mbox{\hyperlink{a00357_gga662b2b6a80547adf4b9ce8b30d87fab5a0d30d757bf062e88728ebe7f8e2b2577}{NonLinearSolverMessages::SOLUTION\_CHANGED}});}
\DoxyCodeLine{387       \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{388         x = xOld\_;}
\DoxyCodeLine{389         eta\_.setZero();}
\DoxyCodeLine{390       \}}
\DoxyCodeLine{391       nonLinearOperator\_.updateAll();}
\DoxyCodeLine{392       stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}} = gradient().norm();}
\DoxyCodeLine{393       this-\/>\mbox{\hyperlink{a01788_a4bce3750aa7d52aff9baf122a54e16b5}{notify}}(\mbox{\hyperlink{a00357_gga662b2b6a80547adf4b9ce8b30d87fab5a073d71a89cce6d4b9775987fdbb22815}{NonLinearSolverMessages::ITERATION\_ENDED}});}
\DoxyCodeLine{394     \}}
\DoxyCodeLine{395     spdlog::info(\textcolor{stringliteral}{"{}\{\}"{}}, info\_.\mbox{\hyperlink{a01644_a8df37485a1fdbbce8d153a8fadd537bf}{reasonString}});}
\DoxyCodeLine{396     spdlog::info(\textcolor{stringliteral}{"{}Total iterations: \{\} Total CG Iterations: \{\}"{}}, stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}}, stats\_.\mbox{\hyperlink{a01648_ac5053b65db9ceae8340aaebe952c7792}{innerIterSum}});}
\DoxyCodeLine{397 }
\DoxyCodeLine{398     solverInformation.success =}
\DoxyCodeLine{399         (info\_.\mbox{\hyperlink{a01644_a68f203529fcd8a947fd49330a83d42b2}{stop}} == \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674ad1c6a6016de417acc66b5ac44a1fdca3}{StopReason::correctionNormTolReached}}) or (info\_.\mbox{\hyperlink{a01644_a68f203529fcd8a947fd49330a83d42b2}{stop}} == \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674a0c4f44592a7ae85baf42cb3fb4a5a3d1}{StopReason::gradientNormTolReached}});}
\DoxyCodeLine{400 }
\DoxyCodeLine{401     solverInformation.iterations   = stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}};}
\DoxyCodeLine{402     solverInformation.residualNorm = stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}};}
\DoxyCodeLine{403     \textcolor{keywordflow}{if} (solverInformation.success)}
\DoxyCodeLine{404       this-\/>\mbox{\hyperlink{a01788_a4bce3750aa7d52aff9baf122a54e16b5}{notify}}(\mbox{\hyperlink{a00357_gga662b2b6a80547adf4b9ce8b30d87fab5a15380ac35d47cdbcbd64aada4bc21931}{NonLinearSolverMessages::FINISHED\_SUCESSFULLY}}, solverInformation.iterations);}
\DoxyCodeLine{405     \textcolor{keywordflow}{return} solverInformation;}
\DoxyCodeLine{406   \}}
\DoxyCodeLine{411   \textcolor{keyword}{auto}\& \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}() \{ \textcolor{keywordflow}{return} nonLinearOperator\_; \}}
\DoxyCodeLine{412 }
\DoxyCodeLine{413 \textcolor{keyword}{private}:}
\DoxyCodeLine{414   \textcolor{keywordtype}{void} logState()\textcolor{keyword}{ const }\{}
\DoxyCodeLine{415     spdlog::info(}
\DoxyCodeLine{416         \textcolor{stringliteral}{"{}\{:>3s\} \{:>3s\} \{:>6d\} \{:>9d\}  \{:>6.2f\}  \{:>9.2e\}  \{:>9.2e\}  \{:>11.2e\}  \{:>9.2e\}  \{:>9.2e\}  \{:>11.2e\}   "{}}}
\DoxyCodeLine{417         \textcolor{stringliteral}{"{}\{:<73\}"{}},}
\DoxyCodeLine{418         info\_.\mbox{\hyperlink{a01644_af3d423f3f05e0bdd445e2b9de7dc9daf}{accstr}}, info\_.\mbox{\hyperlink{a01644_ae987404091035ade31e839e9f00b7cbd}{trstr}}, stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}}, innerInfo\_.\mbox{\hyperlink{a01568_aea7d60a8e86f8c8a17251b1da948ea68}{numInnerIter}}, stats\_.\mbox{\hyperlink{a01648_a1111f89e925a512bd145b50a8f25c2be}{rho}}, stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}},}
\DoxyCodeLine{419         stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}}, stats\_.\mbox{\hyperlink{a01648_a3a03ce164638213312bece9e8b54fdcd}{energyProposal}} -\/ stats\_.\mbox{\hyperlink{a01648_a43b868b19908b5435f1e2f18fb1d7625}{energy}}, stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}}, innerInfo\_.\mbox{\hyperlink{a01568_a8e52ebafb750281e8b3f00cb698bd3dd}{Delta}}, stats\_.\mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}},}
\DoxyCodeLine{420         info\_.\mbox{\hyperlink{a01644_af34cb5bb79e983db99b959d871afd353}{stopReasonString}} + info\_.\mbox{\hyperlink{a01644_a3947b27f29bf44beb7f3f19e91c344f9}{cauchystr}} + info\_.\mbox{\hyperlink{a01644_a84be03aa6ebbd80ab2e6fac5a78aacd3}{randomPredictionString}});}
\DoxyCodeLine{421   \}}
\DoxyCodeLine{422 }
\DoxyCodeLine{423   \textcolor{keywordtype}{void} logFinalState() \{}
\DoxyCodeLine{424     spdlog::info(\textcolor{stringliteral}{"{}\{:>3s\} \{:>3s\} \{:>6d\} \{:>9d\}  \{: \string^6\}  \{: \string^9\}  \{: \string^9\}  \{: \string^11\}  \{:>9.2e\}  \{: \string^9\}  \{: \string^11\}   \{:<73\}"{}},}
\DoxyCodeLine{425                  info\_.\mbox{\hyperlink{a01644_af3d423f3f05e0bdd445e2b9de7dc9daf}{accstr}}, info\_.\mbox{\hyperlink{a01644_ae987404091035ade31e839e9f00b7cbd}{trstr}}, stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}}, innerInfo\_.\mbox{\hyperlink{a01568_aea7d60a8e86f8c8a17251b1da948ea68}{numInnerIter}}, \textcolor{stringliteral}{"{} "{}}, \textcolor{stringliteral}{"{} "{}}, \textcolor{stringliteral}{"{} "{}}, \textcolor{stringliteral}{"{} "{}},}
\DoxyCodeLine{426                  stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}}, \textcolor{stringliteral}{"{} "{}}, \textcolor{stringliteral}{"{} "{}}, info\_.\mbox{\hyperlink{a01644_af34cb5bb79e983db99b959d871afd353}{stopReasonString}} + info\_.\mbox{\hyperlink{a01644_a3947b27f29bf44beb7f3f19e91c344f9}{cauchystr}} + info\_.\mbox{\hyperlink{a01644_a84be03aa6ebbd80ab2e6fac5a78aacd3}{randomPredictionString}});}
\DoxyCodeLine{427   \}}
\DoxyCodeLine{428 }
\DoxyCodeLine{429   \textcolor{keyword}{inline} \textcolor{keyword}{const} \textcolor{keyword}{auto}\& energy() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().value(); \}}
\DoxyCodeLine{430   \textcolor{keyword}{inline} \textcolor{keyword}{const} \textcolor{keyword}{auto}\& gradient() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().derivative(); \}}
\DoxyCodeLine{431   \textcolor{keyword}{inline} \textcolor{keyword}{const} \textcolor{keyword}{auto}\& hessian() \{ \textcolor{keywordflow}{return} \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().secondDerivative(); \}}
\DoxyCodeLine{432 }
\DoxyCodeLine{433   \textcolor{keywordtype}{bool} stoppingCriterion() \{}
\DoxyCodeLine{434     std::ostringstream stream;}
\DoxyCodeLine{436     \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}} < settings\_.\mbox{\hyperlink{a01632_a1cc69f38c3569c63cb4bf86a39a16050}{grad\_tol}} \&\& stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}} != 0) \{}
\DoxyCodeLine{437       logFinalState();}
\DoxyCodeLine{438       spdlog::info(\textcolor{stringliteral}{"{}CONVERGENCE:  Energy: \{:1.16e\}    norm(gradient): \{:1.16e\}"{}}, \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().value(),}
\DoxyCodeLine{439                    stats\_.\mbox{\hyperlink{a01648_a58ec024d2233720f0bf164b8b21a6626}{gradNorm}});}
\DoxyCodeLine{440       stream << \textcolor{stringliteral}{"{}Gradient norm tolerance reached; options.tolerance = "{}} << settings\_.\mbox{\hyperlink{a01632_a1cc69f38c3569c63cb4bf86a39a16050}{grad\_tol}};}
\DoxyCodeLine{441 }
\DoxyCodeLine{442       info\_.\mbox{\hyperlink{a01644_a8df37485a1fdbbce8d153a8fadd537bf}{reasonString}} = stream.str();}
\DoxyCodeLine{443 }
\DoxyCodeLine{444       info\_.\mbox{\hyperlink{a01644_a68f203529fcd8a947fd49330a83d42b2}{stop}} = \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674a0c4f44592a7ae85baf42cb3fb4a5a3d1}{StopReason::gradientNormTolReached}};}
\DoxyCodeLine{445       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{446     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}} < settings\_.\mbox{\hyperlink{a01632_ab598fd07116bda4ec7ff4ec10ad771bb}{corr\_tol}} \&\& stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}} != 0) \{}
\DoxyCodeLine{447       logFinalState();}
\DoxyCodeLine{448       spdlog::info(\textcolor{stringliteral}{"{}CONVERGENCE:  Energy: \{:1.16e\}    norm(correction): \{:1.16e\}"{}}, \mbox{\hyperlink{a01640_a58d156c1eb6c5ac3abee28d14beadc2a}{nonLinearOperator}}().value(),}
\DoxyCodeLine{449                    stats\_.\mbox{\hyperlink{a01648_a178607b87a8d27eb7b02bb22dc0d2c63}{etaNorm}});}
\DoxyCodeLine{450       stream << \textcolor{stringliteral}{"{}Displacement norm tolerance reached;  = "{}} << settings\_.\mbox{\hyperlink{a01632_ab598fd07116bda4ec7ff4ec10ad771bb}{corr\_tol}} << \textcolor{stringliteral}{"{}."{}} << std::endl;}
\DoxyCodeLine{451 }
\DoxyCodeLine{452       info\_.\mbox{\hyperlink{a01644_a8df37485a1fdbbce8d153a8fadd537bf}{reasonString}} = stream.str();}
\DoxyCodeLine{453       info\_.\mbox{\hyperlink{a01644_a68f203529fcd8a947fd49330a83d42b2}{stop}}         = \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674ad1c6a6016de417acc66b5ac44a1fdca3}{StopReason::correctionNormTolReached}};}
\DoxyCodeLine{454       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{455     \}}
\DoxyCodeLine{456 }
\DoxyCodeLine{458     \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_ab3cab6865c16d06ec81b5db14b0dc5e2}{time}} >= settings\_.\mbox{\hyperlink{a01632_a65731eb979e7677f54722743edebc4c7}{maxtime}}) \{}
\DoxyCodeLine{459       logFinalState();}
\DoxyCodeLine{460       stream << \textcolor{stringliteral}{"{}Max time exceeded; options.maxtime = "{}} << settings\_.\mbox{\hyperlink{a01632_a65731eb979e7677f54722743edebc4c7}{maxtime}} << \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{461       info\_.\mbox{\hyperlink{a01644_a8df37485a1fdbbce8d153a8fadd537bf}{reasonString}} = stream.str();}
\DoxyCodeLine{462       info\_.\mbox{\hyperlink{a01644_a68f203529fcd8a947fd49330a83d42b2}{stop}}         = \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674ad205528fe2a4412b89626ff7eee936f9}{StopReason::maximumTimeReached}};}
\DoxyCodeLine{463       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{464     \}}
\DoxyCodeLine{465 }
\DoxyCodeLine{467     \textcolor{keywordflow}{if} (stats\_.\mbox{\hyperlink{a01648_a79ff262003d1f3ff65ef2877aca8df0f}{outerIter}} >= settings\_.\mbox{\hyperlink{a01632_ac496e08f6fc420b641d2e838d4adbb53}{maxIter}}) \{}
\DoxyCodeLine{468       logFinalState();}
\DoxyCodeLine{469       stream << \textcolor{stringliteral}{"{}Max iteration count reached; options.maxiter = "{}} << settings\_.\mbox{\hyperlink{a01632_ac496e08f6fc420b641d2e838d4adbb53}{maxIter}} << \textcolor{stringliteral}{"{}."{}};}
\DoxyCodeLine{470       info\_.\mbox{\hyperlink{a01644_a8df37485a1fdbbce8d153a8fadd537bf}{reasonString}} = stream.str();}
\DoxyCodeLine{471       info\_.\mbox{\hyperlink{a01644_a68f203529fcd8a947fd49330a83d42b2}{stop}}         = \mbox{\hyperlink{a00363_abd5d0cf356d1ae81f6ee827b0f47c674a5ed07f9461b91dd3a6ba961a0ed5c8fe}{StopReason::maximumIterationsReached}};}
\DoxyCodeLine{472       \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{473     \}}
\DoxyCodeLine{474     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{475   \}}
\DoxyCodeLine{476 }
\DoxyCodeLine{477   \textcolor{keywordtype}{void} solveInnerProblem() \{}
\DoxyCodeLine{478     truncatedConjugateGradient\_.\mbox{\hyperlink{a01572_abca8364ed9fadd6e08510b46395dbf22}{setInfo}}(innerInfo\_);}
\DoxyCodeLine{479     \textcolor{keywordtype}{int} attempts = 0;}
\DoxyCodeLine{480     truncatedConjugateGradient\_.factorize(hessian());}
\DoxyCodeLine{481     \textcolor{comment}{// If the preconditioner is IncompleteCholesky the factorization may fail if we have negative diagonal entries and}}
\DoxyCodeLine{482     \textcolor{comment}{// the initial shift is too small. Therefore, if the factorization fails we increase the initial shift by a factor}}
\DoxyCodeLine{483     \textcolor{comment}{// of 5.}}
\DoxyCodeLine{484     \textcolor{keywordflow}{if} \textcolor{keyword}{constexpr} (preConditioner == \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a7a24b184ba388b8e327feb98dbe168ff}{PreConditioner::IncompleteCholesky}}) \{}
\DoxyCodeLine{485       \textcolor{keywordflow}{while} (truncatedConjugateGradient\_.info() != Eigen::Success) \{}
\DoxyCodeLine{486         choleskyInitialShift\_ *= 5;}
\DoxyCodeLine{487         truncatedConjugateGradient\_.preconditioner().setInitialShift(choleskyInitialShift\_);}
\DoxyCodeLine{488         truncatedConjugateGradient\_.factorize(hessian());}
\DoxyCodeLine{489         \textcolor{keywordflow}{if} (attempts > 5)}
\DoxyCodeLine{490           DUNE\_THROW(Dune::MathError, \textcolor{stringliteral}{"{}Factorization of preconditioner failed!"{}});}
\DoxyCodeLine{491         ++attempts;}
\DoxyCodeLine{492       \}}
\DoxyCodeLine{493       \textcolor{keywordflow}{if} (truncatedConjugateGradient\_.info() == Eigen::Success)}
\DoxyCodeLine{494         choleskyInitialShift\_ = 1e-\/3;}
\DoxyCodeLine{495     \}}
\DoxyCodeLine{496     eta\_       = truncatedConjugateGradient\_.solveWithGuess(-\/gradient(), eta\_);}
\DoxyCodeLine{497     innerInfo\_ = truncatedConjugateGradient\_.\mbox{\hyperlink{a01572_a81a7f70d30cfbf103d6ac946ebc2a598}{getInfo}}();}
\DoxyCodeLine{498   \}}
\DoxyCodeLine{499 }
\DoxyCodeLine{500   NLO nonLinearOperator\_;}
\DoxyCodeLine{501   \mbox{\hyperlink{a01640_a7f187a825b0a65e7d9ab1c21578da1cf}{UpdateFunction}} updateFunction\_;}
\DoxyCodeLine{502   \textcolor{keyword}{typename} NLO::template ParameterValue<0> xOld\_;}
\DoxyCodeLine{503   \mbox{\hyperlink{a01640_a1071054a0b75f9fbe27832ea672792b0}{CorrectionType}} eta\_;}
\DoxyCodeLine{504   \mbox{\hyperlink{a01640_a1071054a0b75f9fbe27832ea672792b0}{CorrectionType}} Heta\_;}
\DoxyCodeLine{505   \mbox{\hyperlink{a01640_a4335951e9f140f89f008e020cb32d537}{Settings}} settings\_;}
\DoxyCodeLine{506   AlgoInfo info\_;}
\DoxyCodeLine{507   \textcolor{keywordtype}{double} choleskyInitialShift\_ = 1e-\/3;}
\DoxyCodeLine{508   \mbox{\hyperlink{a01568}{Eigen::TCGInfo<double>}} innerInfo\_;}
\DoxyCodeLine{509   Stats stats\_;}
\DoxyCodeLine{510   \textcolor{keyword}{static} \textcolor{keyword}{constexpr} \textcolor{keywordtype}{double} eps\_ = 0.0001220703125; \textcolor{comment}{// 0.0001220703125 is sqrt(sqrt(maschine-\/precision))}}
\DoxyCodeLine{511   std::array<std::string, 6> tcg\_stop\_reason\_\{}
\DoxyCodeLine{512       \{\textcolor{stringliteral}{"{}negative curvature"{}}, \textcolor{stringliteral}{"{}exceeded trust region"{}}, \textcolor{stringliteral}{"{}reached target residual-\/kappa (linear)"{}},}
\DoxyCodeLine{513        \textcolor{stringliteral}{"{}reached target residual-\/theta (superlinear)"{}}, \textcolor{stringliteral}{"{}maximum inner iterations"{}}, \textcolor{stringliteral}{"{}model increased"{}}\}}
\DoxyCodeLine{514   \};}
\DoxyCodeLine{515 }
\DoxyCodeLine{516   \textcolor{keyword}{using }PreConditionerType =}
\DoxyCodeLine{517       std::conditional\_t<preConditioner == \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a7a93111b975ec3c3824eab230f3ec608}{PreConditioner::IdentityPreconditioner}}, Eigen::IdentityPreconditioner,}
\DoxyCodeLine{518                          std::conditional\_t<preConditioner == \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a3c6b5404db3b7bf45a0302f376a53afc}{PreConditioner::DiagonalPreconditioner}},}
\DoxyCodeLine{519                                             \textcolor{keyword}{typename} Eigen::DiagonalPreconditioner<ScalarType>,}
\DoxyCodeLine{520                                             \textcolor{keyword}{typename} Eigen::IncompleteCholesky<ScalarType>>>;}
\DoxyCodeLine{521   \mbox{\hyperlink{a01572}{Eigen::TruncatedConjugateGradient<MatrixType, Eigen::Lower | Eigen::Upper, PreConditionerType>}}}
\DoxyCodeLine{522       truncatedConjugateGradient\_;}
\DoxyCodeLine{523 \};}
\DoxyCodeLine{524 }
\DoxyCodeLine{535 \textcolor{keyword}{template} <\textcolor{keyword}{typename} NLO, \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66}{PreConditioner}} preConditioner = \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a7a24b184ba388b8e327feb98dbe168ff}{PreConditioner::IncompleteCholesky}},}
\DoxyCodeLine{536           \textcolor{keyword}{typename} UF = utils::UpdateDefault>}
\DoxyCodeLine{537 \textcolor{keyword}{auto} \mbox{\hyperlink{a00363_a547326eb09552d3d1fed0830d0e2d269}{makeTrustRegion}}(\textcolor{keyword}{const} NLO\& nonLinearOperator, UF\&\& updateFunction = \{\}) \{}
\DoxyCodeLine{538   \textcolor{keywordflow}{return} std::make\_shared<TrustRegion<NLO, preConditioner, UF>>(nonLinearOperator, updateFunction);}
\DoxyCodeLine{539 \}}
\DoxyCodeLine{540 }
\DoxyCodeLine{541 \textcolor{keyword}{template} <\textcolor{keyword}{typename} NLO, \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66}{PreConditioner}} preConditioner = \mbox{\hyperlink{a00363_ace28d4868cfc647491f7938f04ef6c66a7a24b184ba388b8e327feb98dbe168ff}{PreConditioner::IncompleteCholesky}},}
\DoxyCodeLine{542           \textcolor{keyword}{typename} UF2 = utils::UpdateDefault>}
\DoxyCodeLine{543 \mbox{\hyperlink{a00363_a8d76e20d6a74e339f85d98c9854ee89c}{TrustRegion}}(\textcolor{keyword}{const} NLO\& nonLinearOperator,}
\DoxyCodeLine{544             UF2\&\& updateFunction = \{\}) -\/> \mbox{\hyperlink{a00363_a8d76e20d6a74e339f85d98c9854ee89c}{TrustRegion}}<NLO, preConditioner, std::remove\_cvref\_t<UF2>>;}
\DoxyCodeLine{545 }
\DoxyCodeLine{546 \} \textcolor{comment}{// namespace Ikarus}}

\end{DoxyCode}
