
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ikarus documentation.">
      
      
        <meta name="author" content="The Ikarus Developers">
      
      
        <link rel="canonical" href="https://ikarus-project.github.io/dev/01_framework/localFunctions/">
      
      
        <link rel="prev" href="../localBasis/">
      
      
        <link rel="next" href="../feRequirements/">
      
      
        
      
      
      <link rel="icon" href="../../auxiliaryImages/logo_blue.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.1+insiders-4.53.15">
    
    
      
        <title>Local functions - Ikarus</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f50c755.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="Local functions - Ikarus" />
<meta property="og:description" content="Ikarus documentation." />
<meta property="og:image" content="https://ikarus-project.github.io/dev/assets/images/social/01_framework/localFunctions.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://ikarus-project.github.io/dev/01_framework/localFunctions/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:title" content="Local functions - Ikarus" />
<meta property="twitter:description" content="Ikarus documentation." />
<meta property="twitter:image" content="https://ikarus-project.github.io/dev/assets/images/social/01_framework/localFunctions.png" />
 <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="pink">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#local-functions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Ikarus" class="md-header__button md-logo" aria-label="Ikarus" data-md-component="logo">
      
  <img src="../../auxiliaryImages/logo_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ikarus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Local functions
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ikarus-project/ikarus" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ikarus-project/ikarus
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../download/" class="md-tabs__link">
        
  
    
  
  Download

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Framework

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../02_examples/" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../03_contribution/openTask/" class="md-tabs__link">
          
  
    
  
  How to contribute

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../05_cppReferences/cppRef/" class="md-tabs__link">
        
  
    
  
  C++ recommendations

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../99_Literature/99Literature/" class="md-tabs__link">
        
  
    
  
  Literature

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../gallery/" class="md-tabs__link">
        
  
    
  
  Gallery

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../about/" class="md-tabs__link">
        
  
    
  
  About

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../04_blog/" class="md-tabs__link">
          
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../doxygen/html/" class="md-tabs__link">
        
  
    
  
  Class Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Ikarus" class="md-nav__button md-logo" aria-label="Ikarus" data-md-component="logo">
      
  <img src="../../auxiliaryImages/logo_white.png" alt="logo">

    </a>
    Ikarus
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ikarus-project/ikarus" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    ikarus-project/ikarus
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../download/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Download
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Framework
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Framework
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grids/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Grids
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../localBasis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Local basis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    
  
    Local functions
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    
  
    Local functions
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients" class="md-nav__link">
    <span class="md-ellipsis">
      
        Derivatives w.r.t. coefficients
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients-and-spatial-derivatives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Derivatives w.r.t. coefficients and spatial derivatives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dirichlet-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Dirichlet energy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-implement-your-own-local-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to implement your own local functions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Expressions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tagging-leaf-local-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tagging leaf local functions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-your-own-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Writing your own expressions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Writing your own expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementing-the-return-value" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementing the return value
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-the-underlying-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluate the underlying functions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../feRequirements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    FE requirements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../finiteElements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Finite elements
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../assembler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Assembler
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dirichletBCs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Dirichlet boundary conditions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../solvers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Solvers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nonlinearOperator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Nonlinear operator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../controlRoutines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Control routines
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--new" title="Recently added or heavily refactored">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../manifolds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Manifolds
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../observer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Observer and observables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../02_examples/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/computePi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Compute the value of pi
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/cantileverBeam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Cantilever beam with point load
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/incompressibleRubberBlock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Compression of an incompressible rubber block
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/kirchhoffPlate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Plate subjected to a surface load
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/newtonRaphsonMethod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Newton-Raphson method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/nonLinearElasticity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Non-linear elasticity for 2D solids
  

    
  </span>
  
  
    
  
  
    <span class="md-status md-status--new" title="Recently added or heavily refactored">
    </span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/vonMisesTruss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Von Mises truss
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02_examples/cooksMembrane/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Cook's membrane
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    How to contribute
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    How to contribute
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_contribution/openTask/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Open Tasks
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_contribution/codeStyle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Code style
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_contribution/howToEdit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Edit the documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03_contribution/buildDocumentationLocally/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Build the documentation locally
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05_cppReferences/cppRef/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    C++ recommendations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../99_Literature/99Literature/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Literature
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gallery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Gallery
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../04_blog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_2" >
        
          
          <label class="md-nav__link" for="__nav_10_2" id="__nav_10_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2024
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    2022
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10_3" >
        
          
          <label class="md-nav__link" for="__nav_10_3" id="__nav_10_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_10_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/clang/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Clang
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/docker-images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Docker images
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/licenses/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Licenses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/linear-elasticity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Linear elasticity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/path-following/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Path-following
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/prometheus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Prometheus
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/python-bindings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Python Bindings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/release/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Release
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../04_blog/category/structural-mechanics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Structural mechanics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../doxygen/html/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    
  
    Class Reference
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interface
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients" class="md-nav__link">
    <span class="md-ellipsis">
      
        Derivatives w.r.t. coefficients
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients-and-spatial-derivatives" class="md-nav__link">
    <span class="md-ellipsis">
      
        Derivatives w.r.t. coefficients and spatial derivatives
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dirichlet-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example: Dirichlet energy
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementations" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementations
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-implement-your-own-local-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        How to implement your own local functions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Expressions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tagging-leaf-local-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tagging leaf local functions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-your-own-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Writing your own expressions
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Writing your own expressions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementing-the-return-value" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementing the return value
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-the-underlying-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Evaluate the underlying functions
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="local-functions">Local functions<a class="headerlink" href="#local-functions" title="Permanent link">&para;</a></h1>
<p>Local functions are functions that are bound to single grid elements.
Therefore, they are constructed from some local basis, a coefficient vector, and the geometry of the grid element.
Since the implementation is quite involved, <code>localfefunctions</code> do not reside at Ikarus but in the separate
module <a href="https://github.com/ikarus-project/dune-localfefunctions">dune-localfefunctions</a>.</p>
<p>Usually, local functions are need to be evaluated in the local coordinate system <span class="arithmatex">\( \mathbb{\xi} \in T_{\text{ref}} \subset\mathbb{R}^n \)</span> :</p>
<div class="arithmatex">\[
f: \boldsymbol{\xi}^n \rightarrow \mathbb{R}^m
\]</div>
<p>where <span class="arithmatex">\(T_{\text{ref}}\)</span> is the reference element, e.g., for a hypercube, <span class="arithmatex">\(T_{\text{ref}}= [0,1]^d\)</span>.</p>
<h2 id="interface">Interface<a class="headerlink" href="#interface" title="Permanent link">&para;</a></h2>
<p>Local functions provide the following interface:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">LocalFunction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Dune</span><span class="o">::</span><span class="n">CachedLocalBasis</span><span class="o">&lt;</span><span class="n">DuneBasis</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">p_basis</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">CoeffContainer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">coeffs_</span><span class="p">,</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">              </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">Geometry</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">geo</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">              </span><span class="n">Dune</span><span class="o">::</span><span class="k">template</span><span class="w"> </span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Dune</span><span class="o">::</span><span class="k">template</span><span class="w"> </span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">&gt;</span><span class="p">{});</span><span class="w"> </span><span class="c1">// (1)!</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">FunctionReturnType</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">local</span><span class="p">);</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">FunctionReturnType</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">integrationPointIndex</span><span class="p">);</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">local</span><span class="p">,...);</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">integrationPointIndex</span><span class="p">,...);</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">auto</span><span class="w"> </span><span class="n">viewOverIntegrationPoints</span><span class="p">();</span><span class="w"> </span><span class="c1">// (2)!</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)!</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="k">auto</span><span class="w"> </span><span class="n">basis</span><span class="p">(</span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// (4)!</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="k">auto</span><span class="w"> </span><span class="n">coefficientsRef</span><span class="p">(</span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (5)!</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">IntegrationRule</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Ints</span><span class="o">&gt;</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="kt">void</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">IntegrationRule</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p_rule</span><span class="p">,</span><span class="w"> </span><span class="n">Derivatives</span><span class="o">&lt;</span><span class="n">Ints</span><span class="p">...</span><span class="o">&gt;&amp;&amp;</span><span class="w"> </span><span class="n">ints</span><span class="p">);</span><span class="w"> </span><span class="c1">// (6)!</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="k">auto</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="c1">// (7)!</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">ScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="k">auto</span><span class="w"> </span><span class="n">rebindClone</span><span class="w"> </span><span class="p">(</span><span class="n">ScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (8)!</span>
</code></pre></div>
<ol>
<li>The constructor takes a <code>Dune::CachedLocalBasis</code>, a vector of coefficients and a shared pointer to the geometry of the grid elements.
   Additionally, the local function can be tagged with a compile-time constant, e.g., <code>Dune::template index_constant&lt;0&gt;</code> or
   <code>Dune::Indices::_0</code>.</li>
<li>This returns a vector of structs representing the integration point and its index. Therefore, the syntax is <code class="highlight"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w">   </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{...}</span></code></li>
<li>Returns the order of the local function with respect to the coefficients. An id tag can be passed, which returns the order with
   respect to a tagged function. For details, see <a href="#tagging-leaf-local-functions">Tagging leaf local functions</a>.</li>
<li>Returns the basis of the local function. An id tag can be passed, which returns the basis of a specific tagged function. For details
   see <a href="#tagging-leaf-local-functions">Tagging leaf local functions</a>.</li>
<li>Returns a reference to the coefficient of the underlying leaf local finite elements. An id tag can be passed, which returns the basis
   of a specific tagged function. It can return a const or non-const reference. The non-const version is deactivated, if there is more
   than one leaf node with the passed id tag.  For details, see <a href="#tagging-leaf-local-functions">Tagging leaf local functions</a>.</li>
<li>This function is passed to the given <code>localBasis</code>. See <a href="../localBasis/">link</a></li>
<li>Clones the local function and stores a copy of all leave nodes.</li>
<li>Clones the local function and rebinds the scalar type of the coefficients with id tag <code>ID</code>. This comes in handy if, for example, one
   wants to replace doubles with an autodiff type.</li>
</ol>
<p>The "..." in the <code>evaluateDerivative</code> function call refers to several possible variadic templates.
The implementation looks like the following:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Usage with integration point index</label><label for="__tabbed_1_2">using integration point coordinates</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">DerivativeDirections</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span><span class="w"> </span><span class="n">bindDerivatives</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">()){</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">));</span><span class="w"> </span><span class="c1">// (1)!</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">));</span><span class="w"> </span><span class="c1">// (2)!</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">}</span>
</code></pre></div>
<ol>
<li>Compute the spatial Jacobian of localFunction</li>
<li>Compute the spatial Jacobian of localFunction and transform it to the grid element</li>
</ol>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">DerivativeDirections</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">gp</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">rule</span><span class="p">){</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">(),</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">));</span><span class="w"> </span><span class="c1">// (1)!</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">(),</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">));</span><span class="w"> </span><span class="c1">// (2)!</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span>
</code></pre></div>
<ol>
<li>Compute the spatial Jacobian of localFunction</li>
<li>Compute the spatial Jacobian of localFunction and transform it to the grid element</li>
</ol>
</div>
</div>
</div>
<p>where the first call implements</p>
<div class="arithmatex">\[
\operatorname{grad}_\boldsymbol{\xi} f : \boldsymbol{\xi} \rightarrow \mathbb{R}^{m \times d}.
\]</div>
<p>The second one takes into account the fact that the local function is defined in some physical space <span class="arithmatex">\(\boldsymbol{X}\)</span> with the
coordinate <span class="arithmatex">\(\boldsymbol{x}\)</span>.
Therefore, it transforms the Jacobian from the reference element <span class="arithmatex">\(\operatorname{grad}_{\boldsymbol{\xi}}\)</span> to the Jacobian on the grid
element <span class="arithmatex">\(\operatorname{grad}_\boldsymbol{x}\)</span>.
This behavior is activated, if <code>on(gridElement)</code> is passed; otherwise, if the derivatives on the reference element is needed, pass <code>on
(referenceElement)</code>.
Here, <code>gridElement</code> and <code>referenceElement</code> are global constants in the namespace <code>Dune::DerivativeDirections</code>.</p>
<p>Thus, if <code>on(gridElement)</code> is passed, the local function usually implements</p>
<div class="arithmatex">\[
\operatorname{grad}_\boldsymbol{x} = \operatorname{grad}_{\boldsymbol{\xi}} \boldsymbol{J}^{-1}
\]</div>
<p>where <span class="arithmatex">\(J\)</span> is the Jacobian of the mapping from the reference element <span class="arithmatex">\(T_{\text{ref}}\)</span> to the element living in physical space <span class="arithmatex">\(T\)</span>.
For details, see page 22 of the Dune book<sup id="fnref:sander2020dune"><a class="footnote-ref" href="#fn:sander2020dune">1</a></sup>.</p>
<p>Instead of passing <code>spatialAll</code> to <code>wrt(..)</code>, there are other helper functions such as:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span><span class="w"> </span><span class="c1">// (1)!</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span><span class="w"> </span><span class="c1">// (2)!</span>
</code></pre></div>
<ol>
<li>Compute the first column of the spatial Jacobian of <code>localFunction</code></li>
<li>Compute the second column of the spatial Jacobian of <code>localFunction</code></li>
</ol>
<p>which can also be combined with <code>on(...)</code>.</p>
<h2 id="derivatives-wrt-coefficients">Derivatives w.r.t. coefficients<a class="headerlink" href="#derivatives-wrt-coefficients" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">)));</span>
</code></pre></div>
<p>which evaluates the first derivative for a vector space valued function,e.g., for <span class="arithmatex">\(f(\boldsymbol{\xi}) = \sum_{I=1}^n N^I(\boldsymbol{\xi}) \boldsymbol{x}_I\)</span>,
we arrive at a matrix <span class="arithmatex">\(\boldsymbol{A}\)</span> such that</p>
<div class="arithmatex">\[
[\boldsymbol{A}]_{ij}  = A_{ij} =  \frac{\partial f_i(\boldsymbol{\xi})}{\partial \boldsymbol{x}_j}
\]</div>
<p>and the second derivative</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">q</span><span class="p">));</span>
</code></pre></div>
<div class="arithmatex">\[
[\boldsymbol{B}]_{jk} =  B_{jk} = q_i A_{ijk} =  \frac{\partial^2 (q_i  f_i(\boldsymbol{\xi}))}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}
\]</div>
<p>where <span class="arithmatex">\(\boldsymbol{q}\)</span> is an arbitrary vector of the same size as <span class="arithmatex">\(f\)</span>, i.e., it is the direction of the derivative in this case.
<span class="arithmatex">\(\boldsymbol{A}\)</span> and <span class="arithmatex">\(\boldsymbol{B}\)</span> are simply then the returned matrices and do not have any special meaning.
If a vector is not passed while evaluating the second derivative, the result would be a third-order tensor for a vector-valued function <span class="arithmatex">\(f\)</span>.
As a result, a direction derivative in the direction given by <code>along(q)</code> is computed to return a matrix <span class="arithmatex">\(\boldsymbol{B}\)</span> in this case.
This helps for both readability and performance. See the <a href="#example-dirichlet-energy">example</a> later for more details.</p>
<h2 id="derivatives-wrt-coefficients-and-spatial-derivatives">Derivatives w.r.t. coefficients and spatial derivatives<a class="headerlink" href="#derivatives-wrt-coefficients-and-spatial-derivatives" title="Permanent link">&para;</a></h2>
<p>Spatial derivatives and derivatives w.r.t. the coefficients can be combined. Therefore, it is legal to call</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">Q</span><span class="p">));</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">q</span><span class="p">));</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatial</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">q</span><span class="p">));</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The order of spatial and coefficient derivatives does not matter. The returned value is always rearranged so that the first derivative is the spatial one.</p>
</div>
<p>The first line is then equivalent to</p>
<div class="arithmatex">\[
[\boldsymbol{B}]_{jk} =  B_{jk} = Q_{il} A_{iljk} =  \frac{\partial^2
([\operatorname{grad}_\boldsymbol{\xi} f(\boldsymbol{\xi})]_{il} Q_{il} )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}.
\]</div>
<p>For the second and third line, we have</p>
<div class="arithmatex">\[\begin{align}
\boldsymbol{b}_{0,jk} = \frac{\partial^2
([\operatorname{grad}_{\xi^0} f(\xi)]_{i} q_i )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}, \\
\boldsymbol{b}_{1,jk} = \frac{\partial^2 ([\operatorname{grad}_{\xi^1} f(\xi)]_{i} q_i )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}.
\end{align}\]</div>
<p>These objects are also returned when the second and third lines above are used.</p>
<p>All of these function calls, once again, can be combined with <code>on(gridElement)</code> as shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">Q</span><span class="p">),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">));</span>
</code></pre></div>
<p>which computes</p>
<div class="arithmatex">\[
\frac{\partial^2 ([\operatorname{grad}_\boldsymbol{x} f(\boldsymbol{\xi})]_{il} Q_{il} )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}.
\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently, only first-order spatial derivatives and second-order derivatives w.r.t. the coefficients are supported.</p>
</div>
<h2 id="example-dirichlet-energy">Example: Dirichlet energy<a class="headerlink" href="#example-dirichlet-energy" title="Permanent link">&para;</a></h2>
<p>This example shows how the energy, gradient, and Hessian of a <a href="https://en.wikipedia.org/wiki/Dirichlet_energy">dirichlet energy</a> can be calculated.
$$
E(\boldsymbol{u}) = \frac{1}{2} \int_\Omega ||\operatorname{grad}_\boldsymbol{x} \boldsymbol{u}(\boldsymbol{x})|| ^2 \textrm{d} \boldsymbol{x}
$$</p>
<p>If the energy is to be minimized w.r.t. the coefficients of the nodes, the energy, gradient, and Hessian w.r.t. the coefficients are to be calculated.
Of course, this depends on the optimization algorithms, but for now, the general case where all three are needed is considered.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">dirichletEnergy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="c1">// bind localBasis to some integration rule</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="c1">// create uNodalCoeffs</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="w"> </span><span class="nf">uFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">uNodalCoeffs</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="c1">//.. calculate the inverse Jacobian of the geometry</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gradu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">));</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="n">energy</span><span class="o">+=</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">gradu</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradu</span><span class="p">).</span><span class="n">trace</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gp</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="o">-&gt;</span><span class="n">integrationElement</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">());</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">gradientDirichletEnergy</span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span><span class="w"> </span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="c1">//.bind localBasis to some integration rule</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="c1">// create uNodalCoeffs</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="c1">// spatial size of u</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">      </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="w"> </span><span class="n">uFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">uNodalCoeffs</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">);</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="c1">//.. calculate the inverse Jacobian of the geometry</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gradu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">));</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//loop over coeffs, i.e.nodes of the finite element</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduDCoeffs</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="w"> </span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">));</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">      </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">      </span><span class="n">tmp</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDimension</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">        </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">graduDCoeffs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradu</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">k</span><span class="p">);</span><span class="w">  </span><span class="c1">// (1)!</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">      </span><span class="n">g</span><span class="p">.</span><span class="n">segment</span><span class="o">&lt;</span><span class="n">size</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gp</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="o">-&gt;</span><span class="n">integrationElement</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">());</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="p">}</span>
</code></pre></div>
<ol>
<li><code>graduDCoeffs</code> contains in <code>graduDCoeffs[0]</code> the derivatives w.r.t. the coefficient of the first column, and at <code>graduDCoeffs[1]</code> the
   derivatives w.r.t. the second column of <code>gradu</code>.</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">hessianDirichletEnergy</span><span class="p">(</span><span class="n">Matrix</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="c1">//... bind localBasis to some integration rule</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="c1">// and create uNodalCoeffs</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="c1">// spatial size of u</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">      </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="w"> </span><span class="n">uFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">uNodalCoeffs</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">);</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="c1">//.. calculate the inverse Jacobian of the geometry</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">coeffs</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span><span class="n">nodes</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">finite</span><span class="w"> </span><span class="n">element</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduDCoeffsI</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="w"> </span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">));</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//loop over coeffs, i.e.nodes of the finite element</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduDCoeffsJ</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="w"> </span><span class="n">coeffs</span><span class="p">),</span><span class="w"> </span><span class="n">on</span><span class="p">(</span><span class="n">gridElement</span><span class="p">),</span><span class="w"> </span><span class="n">coeffIndices</span><span class="p">(</span><span class="n">j</span><span class="p">));</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">        </span><span class="n">tmp</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDimension</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">          </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">graduDCoeffsI</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">graduDCoeffsJ</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">        </span><span class="n">h</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gp</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="o">-&gt;</span><span class="n">integrationElement</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">());</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="p">}</span>
</code></pre></div>
<h2 id="implementations">Implementations<a class="headerlink" href="#implementations" title="Permanent link">&para;</a></h2>
<p>In the following, the local functions that are currently available are summarized.
The ansatz functions are denoted as <span class="arithmatex">\(N^i(\boldsymbol{\xi})\)</span> in the table below.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Interpolation formula</th>
<th style="text-align: left;">Note</th>
<th>Header</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Standard</td>
<td style="text-align: left;">$$ \boldsymbol{x} = \sum_{i=1}^n N^i(\boldsymbol{\xi}) \boldsymbol{x}_i  $$</td>
<td style="text-align: left;">-</td>
<td><code>standardLocalFunction.hh</code></td>
</tr>
<tr>
<td style="text-align: left;">Projection-Based<sup id="fnref:grohs_ProjectionBasedFinite2019"><a class="footnote-ref" href="#fn:grohs_ProjectionBasedFinite2019">2</a></sup></td>
<td style="text-align: left;">$$ \boldsymbol{x} = P\left(\sum_{i=1}^n N^i(\boldsymbol{\xi}) \boldsymbol{x}_i \right) $$</td>
<td style="text-align: left;">This is one version of geometric finite elements. These are finite elements suited <br /> for interpolation on manifolds. Here <span class="arithmatex">\(P: \mathbb{R}^m \rightarrow \mathcal{M}\)</span> is an operator that projects <br /> the usual linear interpolation onto a manifold.</td>
<td><code>projectionBasedLocalFunction.hh</code></td>
</tr>
</tbody>
</table>
<h2 id="how-to-implement-your-own-local-functions">How to implement your own local functions<a class="headerlink" href="#how-to-implement-your-own-local-functions" title="Permanent link">&para;</a></h2>
<p>To implement your own local function, the file
<a href="https://github.com/IkarusRepo/Ikarus/src/include/ikarus/localFunctions/impl/localFunctionTemplate.hh"><code>ikarus/localFunctions/impl/localFunctionTemplate.hh</code></a>
is made available.</p>
<p>The file can be copied, and then you can rename the class to your preferred name and implement the functions mentioned below.
If a particular function is not required, it has to be deleted explicitly.
Then, if someone calls that function, it returns a zero matrix or vector of appropriate size.</p>
<p>These functions are all templated with <code>DomainTypeOrIntegrationPointIndex</code>, which is an integration point index or position.
Additionally, <code>On&lt;TransformArgs&gt;</code> specifies whether the function should be evaluated on the reference element or the grid element (see
above).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">FunctionReturnType</span><span class="w"> </span><span class="nf">evaluateFunctionImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">                                        </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)!</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="n">Jacobian</span><span class="w"> </span><span class="nf">evaluateDerivativeWRTSpaceAllImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">                                           </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)!</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="n">JacobianColType</span><span class="w"> </span><span class="nf">evaluateDerivativeWRTSpaceSingleImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">                                                     </span><span class="kt">int</span><span class="w"> </span><span class="n">spaceIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (3)!</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="n">CoeffDerivMatrix</span><span class="w"> </span><span class="nf">evaluateDerivativeWRTCoeffsImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">                                                 </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (4)!</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="n">CoeffDerivMatrix</span><span class="w"> </span><span class="nf">evaluateSecondDerivativeWRTCoeffsImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="w">                                                       </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">                                                       </span><span class="k">const</span><span class="w"> </span><span class="n">Along</span><span class="o">&lt;</span><span class="n">AlongArgs</span><span class="p">...</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">alongArgs</span><span class="p">,</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">                                                       </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (5)!</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">CoeffDerivEukRieMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">gridDim</span><span class="o">&gt;</span><span class="w"> </span><span class="n">evaluateDerivativeWRTCoeffsANDSpatialImpl</span><span class="p">(</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (6)!</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="n">CoeffDerivEukRieMatrix</span><span class="w"> </span><span class="nf">evaluateDerivativeWRTCoeffsANDSpatialSingleImpl</span><span class="p">(</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">spatialIndex</span><span class="p">,</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w">  </span><span class="c1">// (7)!</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateThirdDerivativeWRTCoeffsTwoTimesAndSpatialImpl</span><span class="p">(</span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Along</span><span class="o">&lt;</span><span class="n">AlongArgs</span><span class="p">...</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">alongArgs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (8)!</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="n">CoeffDerivMatrix</span><span class="w"> </span><span class="nf">evaluateThirdDerivativeWRTCoeffsTwoTimesAndSpatialSingleImpl</span><span class="p">(</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">DomainTypeOrIntegrationPointIndex</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ipIndexOrPosition</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">spatialIndex</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Along</span><span class="o">&lt;</span><span class="n">AlongArgs</span><span class="p">...</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">alongArgs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">On</span><span class="o">&lt;</span><span class="n">TransformArgs</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span><span class="c1">// (9)!</span>
</code></pre></div>
<ol>
<li>This is called by <code>localFunction.evaluate(...)</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatialAll))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatial(i)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(coeff(j)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(coeff(j,k)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatialAll,coeff(j)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatial(i),coeff(j)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatialAll,coeff(j,k)), along(A))</code>. <code>A</code> can be accessed via <code>std::get&lt;0&gt;(alongArgs.args)</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatial(i),coeff(j,k)), along(v))</code>. <code>v</code> can be accessed via <code>std::get&lt;0&gt;(alongArgs.args)</code>.</li>
</ol>
<h2 id="expressions">Expressions<a class="headerlink" href="#expressions" title="Permanent link">&para;</a></h2>
<p><a href="https://de.wikipedia.org/wiki/Expression_Templates">Expression templates</a> are usually used in linear algebra libraries, e.g.,
<a href="https://eigen.tuxfamily.org">Eigen</a> or <a href="https://bitbucket.org/blaze-lib/blaze/src/master/">Blaze</a>.
The syntax is similar to the one provided by <a href="https://fenics.readthedocs.io/projects/ufl/en/latest/manual/form_language.html">UML</a> but
only acts on local functions.
Expression templates are used here to combine existing local functions in order to obtain new nested ones.</p>
<p>For example, consider the following code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">...</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">);</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">);</span>
</code></pre></div>
<p>Two local functions that satisfy the interface described above are created.
Now it is possible to combine these functions and get an object that also satisfies the concept above.
Thus, the following is possible:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">...</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">);</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">);</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">g</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">spatial</span><span class="p">(</span><span class="n">d</span><span class="p">)));</span>
</code></pre></div>
<p>Currently, binary and unary expressions are supported. The following expressions are defined:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Mathematical formula</th>
<th style="text-align: left;">Code</th>
<th style="text-align: left;">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Sum</td>
<td style="text-align: left;">$$ \boldsymbol{f} + \boldsymbol{g}  $$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">f</span><span class="o">+</span><span class="n">g</span></code></td>
<td style="text-align: left;"><span class="arithmatex">\(\boldsymbol{f}\)</span>  and  <span class="arithmatex">\(\boldsymbol{g}\)</span> needs to be of the same size.</td>
</tr>
<tr>
<td style="text-align: left;">DotProduct</td>
<td style="text-align: left;">$$ \boldsymbol{f} \cdot \boldsymbol{g} = f_i g_i $$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">)</span></code></td>
<td style="text-align: left;"><span class="arithmatex">\(\boldsymbol{f}\)</span>  and  <span class="arithmatex">\(\boldsymbol{g}\)</span> needs to be of the same size.</td>
</tr>
<tr>
<td style="text-align: left;">normSquared</td>
<td style="text-align: left;">$$ \boldsymbol{f} \cdot \boldsymbol{f} = f_i f_i $$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">normSquared</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">Negate</td>
<td style="text-align: left;">$$ -\boldsymbol{f}  $$</td>
<td style="text-align: left;"><code class="highlight"><span class="o">-</span><span class="n">f</span></code></td>
<td style="text-align: left;"></td>
</tr>
<tr>
<td style="text-align: left;">sqrt</td>
<td style="text-align: left;">$$ \sqrt{f}  $$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code></td>
<td style="text-align: left;">The function <span class="arithmatex">\(f\)</span> needs a scalar return type.</td>
</tr>
<tr>
<td style="text-align: left;">log</td>
<td style="text-align: left;">$$ \log{f}  $$</td>
<td style="text-align: left;"><code class="highlight">log(f)</code></td>
<td style="text-align: left;">The function <span class="arithmatex">\(f\)</span> needs a scalar return type. Here, log is the natural logarithm.</td>
</tr>
<tr>
<td style="text-align: left;">pow</td>
<td style="text-align: left;">$$ f^n  $$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">pow</span><span class="o">&lt;</span><span class="n">n</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code></td>
<td style="text-align: left;">The function <span class="arithmatex">\(f\)</span> needs a scalar return type. <span class="arithmatex">\(n\)</span> is an integer given during compile-time.</td>
</tr>
<tr>
<td style="text-align: left;">Scale</td>
<td style="text-align: left;">$$  a f , \quad a \in  \mathbf{R}$$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">a</span><span class="o">*</span><span class="n">f</span></code> and <code class="highlight"><span class="n">f</span><span class="o">/</span><span class="n">a</span></code></td>
<td style="text-align: left;"><code class="highlight"><span class="n">a</span></code> has to satisfy <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">is_arithmetic</span><span class="o">&lt;</span><span class="p">..</span><span class="o">&gt;</span></code></td>
</tr>
<tr>
<td style="text-align: left;">LinearStrains</td>
<td style="text-align: left;">$$ \frac{1}{2}\left(\boldsymbol{H}+\boldsymbol{H}^T \right),\quad \boldsymbol{H} = \mathrm{grad}(\boldsymbol{f})  $$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">linearStrains</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code></td>
<td style="text-align: left;">If you call the formula on the left with <code>on(gridElement)</code>, it will assume the transformed derivatives.</td>
</tr>
<tr>
<td style="text-align: left;">GreenLagrangianStrains</td>
<td style="text-align: left;">$$ \frac{1}{2}\left(\boldsymbol{H}+\boldsymbol{H}^T +\boldsymbol{H}^T \boldsymbol{H}\right),\quad \boldsymbol{H} = \mathrm{grad}(\boldsymbol{f})  $$</td>
<td style="text-align: left;"><code class="highlight"><span class="n">greenLagrangianStrains</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code></td>
<td style="text-align: left;">If you call the formula on the left with <code>on(gridElement)</code>, it will assume the transformed derivatives.</td>
</tr>
</tbody>
</table>
<p>These expressions can also be nested. As a result, it is valid to write</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">);</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">);</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="o">+</span><span class="n">f</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="n">g</span><span class="p">));</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">spatial</span><span class="p">(</span><span class="n">d</span><span class="p">)));</span>
</code></pre></div>
<p>To use these expressions, there are additional exported static types for all expressions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isLeaf</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)!</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">children</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2)!</span>
</code></pre></div>
<ol>
<li>This is true if the underlying expression is one of the above local functions that really contain the coefficients; see <a href="#implementations">Implementations</a>.</li>
<li>Returns the number of children (2 for binary expressions and 1 for unary expressions).</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use these expression, simply include the header <code class="highlight"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;dune/localfefunctions/expressions.hh&gt;</span></code>.</p>
</div>
<h2 id="tagging-leaf-local-functions">Tagging leaf local functions<a class="headerlink" href="#tagging-leaf-local-functions" title="Permanent link">&para;</a></h2>
<p>In the context of mixed finite elements, there are usually several local functions that contribute to the energy. These stem from
different local bases.
For example, consider the Q1P0 element, where displacements are interpolated by using the four bilinear ansatz functions and the
element-wise constant pressure field.</p>
<p>Then, to obtain gradients and Hessians, we need to differentiate w.r.t. different coefficients.
This can be done by tagging the local function during construction.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">Indices</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis0</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">_0</span><span class="p">);</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis1</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">);</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">);</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">_0</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">_1</span><span class="p">,</span><span class="n">j</span><span class="p">)));</span><span class="w"> </span><span class="c1">// Second derivative w.r.t. the nodal coefficients</span>
</code></pre></div>
<p>To explain the last line above, let us consider that the function f is constructed as <span class="arithmatex">\(f= \sum_{I=0}^n N^L f_L\)</span> and similarly
<span class="arithmatex">\(g= \sum_{I=0}^m M^K g_K\)</span>, where <span class="arithmatex">\(N\)</span> and <span class="arithmatex">\(M\)</span> are ansatz functions and <span class="arithmatex">\(f_L\)</span> and <span class="arithmatex">\(g_K\)</span> are nodal coefficients.</p>
<p>Thus, the above call translates to</p>
<div class="arithmatex">\[\begin{align}
\frac{\partial^2 (\boldsymbol{f} \cdot \boldsymbol{g} )}{\partial \boldsymbol{f}_i\partial \boldsymbol{g}_j},
\end{align}\]</div>
<p>where the correct sizes of the result are derived at compile-time.
The complete Hessian of <span class="arithmatex">\(\boldsymbol{f} \cdot \boldsymbol{g}\)</span> can be calculated by the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">Indices</span><span class="p">;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">hessianDirichletEnergy</span><span class="p">(</span><span class="n">Matrix</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="c1">//... bind localBasis to some integration rule</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">Indices</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis0</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">_0</span><span class="p">);</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis1</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">,</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">_1</span><span class="p">);</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">);</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sizef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">correctionSize</span><span class="p">;</span><span class="w"> </span><span class="c1">// spatial size of the correction of the coefficients of f</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sizeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">correctionSize</span><span class="p">;</span><span class="w"> </span><span class="c1">// spatial size of the correction of the coefficients of g</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffSizef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">  </span><span class="n">Dune</span><span class="o">::</span><span class="n">MultiTypeBlockMatrix</span><span class="o">&lt;</span><span class="n">Dune</span><span class="o">::</span><span class="n">MultiTypeBlockVector</span><span class="o">&lt;</span><span class="n">MatrixBlock00</span><span class="p">,</span><span class="n">MatrixBlock01</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">                                       </span><span class="n">Dune</span><span class="o">::</span><span class="n">MultiTypeBlockVector</span><span class="o">&lt;</span><span class="n">MatrixBlock10</span><span class="p">,</span><span class="n">MatrixBlock11</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">KBlocked</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1)!</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="n">_0</span><span class="p">,</span><span class="n">_0</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">sizef</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">)</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">_0</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">_0</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gp</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="o">-&gt;</span><span class="n">integrationElement</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">());</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="n">_0</span><span class="p">,</span><span class="n">_1</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">sizeg</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">)</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">_0</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">_1</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gp</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="o">-&gt;</span><span class="n">integrationElement</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">());</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="n">_1</span><span class="p">,</span><span class="n">_1</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizeg</span><span class="p">,</span><span class="w"> </span><span class="n">sizeg</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">)</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">_1</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">_1</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gp</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="o">-&gt;</span><span class="n">integrationElement</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">());</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="n">_1</span><span class="p">,</span><span class="n">_0</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">sizeg</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">)</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">_1</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">_0</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gp</span><span class="p">.</span><span class="n">weight</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sharedGeometry</span><span class="o">-&gt;</span><span class="n">integrationElement</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">());</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="p">}</span>
</code></pre></div>
<ol>
<li>This block structure is not necessary. Additionally, in this example, all types (MatrixBlock00, MatrixBlock01, MatrixBlock10,
   MatrixBlock11) are considered as <code class="highlight"><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span></code>.</li>
</ol>
<h2 id="writing-your-own-expressions">Writing your own expressions<a class="headerlink" href="#writing-your-own-expressions" title="Permanent link">&para;</a></h2>
<p>It is also possible to write your own expressions. To do so, please take a look at the existing expressions.
The <code>sqrt</code> and <code>normSquared</code> expressions are the most general unary and binary expressions implemented.</p>
<h3 id="implementing-the-return-value">Implementing the return value<a class="headerlink" href="#implementing-the-return-value" title="Permanent link">&para;</a></h3>
<p>Implementing a return value is the first step in implementing an expression.
This is done by using the following function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">LFArgs</span><span class="o">&gt;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateValueOfExpression</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LFArgs</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lfArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The interface dictates that the return value needs to be an <code>Eigen</code> type. Thus, even if a scalar double is to be returned, it is to</p>
</div>
<p>be wrapped in <code class="highlight"><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span></code></p>
<p>Additionally, the evaluation of the derivative is to be implemented as shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">DerivativeOrder</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">LFArgs</span><span class="o">&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivativeOfExpression</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LFArgs</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lfArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
</code></pre></div>
<h3 id="evaluate-the-underlying-functions">Evaluate the underlying functions<a class="headerlink" href="#evaluate-the-underlying-functions" title="Permanent link">&para;</a></h3>
<p>Expressions always act on existing expressions. Therefore, to have the correct return value for the expression, the underlying
quantities are to be evaluated.
<code class="highlight"><span class="k">this</span><span class="o">-&gt;</span><span class="n">m</span><span class="p">()</span></code> is used to access unary functions, and <code class="highlight"><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">()</span></code> and <code class="highlight"><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">()</span></code> are used to access binary expressions.</p>
<p>To evaluate unary functions, the following syntax is used:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">mEvaluated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">m</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
</code></pre></div>
<p>and for binary functions,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">l_Evaluated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">r_Evaluated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
</code></pre></div>
<p>Because the expression conforms to the syntax of a local function, its derivative can also be evaluated.</p>
<p>In the function <code>evaluateDerivativeOfExpression</code>, the template argument <code>DerivativeOrder</code> contains the derivative order.
Additionally, the derivative types can also be accessed using the static booleans, as shown below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasTwoCoeff</span><span class="p">;</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasSingleCoeff</span><span class="p">;</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasNoCoeff</span><span class="p">;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasNoSpatial</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasOneSpatialAll</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasOneSpatialSingle</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasOneSpatial</span><span class="p">;</span>
</code></pre></div>
<p>Using the <em>dot-product</em> as a binary expression example, we have</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">DerivativeOrder</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">LFArgs</span><span class="o">&gt;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivativeOfExpression</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LFArgs</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lfArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">DerivativeOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)!</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2)!</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_x</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3)!</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">DerivativeOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1">// (4)!</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">u_x</span><span class="p">,</span><span class="w"> </span><span class="n">u_y</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (5)!</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">v_x</span><span class="p">,</span><span class="w"> </span><span class="n">v_y</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasNoSpatial</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasTwoCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (6)!</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonguArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span><span class="w"> </span><span class="c1">// (7)!</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alongvArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">u</span><span class="p">));</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xyAlongv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alongvArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (8)!</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xyAlongu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonguArgs</span><span class="p">);</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">u_xyAlongv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_xyAlongu</span><span class="p">);</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatial</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasSingleCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (9)!</span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (10)!</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialSingle</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasSingleCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (11)!</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_xy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">                                </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_xy</span><span class="p">);</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialAll</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasSingleCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (12)!</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">remove_cvref_t</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">gridDim</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"> </span><span class="c1">// (13)!</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDim</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">              </span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_xy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_x</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_x</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">                                    </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_xy</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">DerivativeOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (14)!</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialSingle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// (15)!</span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">.</span><span class="n">extractSecondWrtArgOrFirstNonSpatial</span><span class="p">();</span><span class="w"> </span><span class="c1">// (16)!</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">u_x</span><span class="p">,</span><span class="w"> </span><span class="n">u_y</span><span class="p">,</span><span class="w"> </span><span class="n">u_z</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (17)!</span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">v_x</span><span class="p">,</span><span class="w"> </span><span class="n">v_y</span><span class="p">,</span><span class="w"> </span><span class="n">v_z</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">u_xy</span><span class="p">,</span><span class="w"> </span><span class="n">u_xz</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (18)!</span>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">v_xy</span><span class="p">,</span><span class="w"> </span><span class="n">v_xz</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonguArgs</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">u</span><span class="p">));</span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alongvArgs</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyzalongv_xArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">v_x</span><span class="p">));</span><span class="w"> </span><span class="c1">// (19)!</span>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyzalongu_xArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">u_x</span><span class="p">));</span>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>
<a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xyzAlongv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alongvArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (20)!</span>
<a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonguArgs</span><span class="p">);</span>
<a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_yzAlongvx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">argsForDyzalongv_xArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (21)!</span>
<a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_yzAlongux</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">argsForDyzalongu_xArgs</span><span class="p">);</span>
<a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>
<a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">u_xyzAlongv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_xy</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_xz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_yzAlongux</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_yzAlongvx</span>
<a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a><span class="w">                              </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_xz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_xy</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="p">);</span>
<a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialAll</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (22)!</span>
<a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">alongMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">.</span><span class="n">alongArgs</span><span class="p">.</span><span class="n">args</span><span class="p">);</span><span class="w"> </span><span class="c1">// (23)!</span>
<a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a>
<a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">uTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">);</span>
<a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">vTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">);</span>
<a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a>
<a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradu</span><span class="p">,</span><span class="w"> </span><span class="n">u_c0</span><span class="p">,</span><span class="w"> </span><span class="n">u_c1</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (24)!</span>
<a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradv</span><span class="p">,</span><span class="w"> </span><span class="n">v_c0</span><span class="p">,</span><span class="w"> </span><span class="n">v_c1</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradu_c0</span><span class="p">,</span><span class="w"> </span><span class="n">gradu_c1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (25)!</span>
<a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradv_c0</span><span class="p">,</span><span class="w"> </span><span class="n">gradv_c1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span>
<a id="__codelineno-23-66" name="__codelineno-23-66" href="#__codelineno-23-66"></a>
<a id="__codelineno-23-67" name="__codelineno-23-67" href="#__codelineno-23-67"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gradu</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">.</span><span class="n">transpose</span><span class="p">()).</span><span class="n">eval</span><span class="p">();</span>
<a id="__codelineno-23-68" name="__codelineno-23-68" href="#__codelineno-23-68"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gradvTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gradv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">.</span><span class="n">transpose</span><span class="p">()).</span><span class="n">eval</span><span class="p">();</span>
<a id="__codelineno-23-69" name="__codelineno-23-69" href="#__codelineno-23-69"></a>
<a id="__codelineno-23-70" name="__codelineno-23-70" href="#__codelineno-23-70"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">.</span><span class="n">extractSecondWrtArgOrFirstNonSpatial</span><span class="p">();</span>
<a id="__codelineno-23-71" name="__codelineno-23-71" href="#__codelineno-23-71"></a>
<a id="__codelineno-23-72" name="__codelineno-23-72" href="#__codelineno-23-72"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonguAArgs</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">uTimesA</span><span class="p">));</span>
<a id="__codelineno-23-73" name="__codelineno-23-73" href="#__codelineno-23-73"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alongvAArgs</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">vTimesA</span><span class="p">));</span>
<a id="__codelineno-23-74" name="__codelineno-23-74" href="#__codelineno-23-74"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonggraduTimesAArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">graduTimesA</span><span class="p">));</span>
<a id="__codelineno-23-75" name="__codelineno-23-75" href="#__codelineno-23-75"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonggradvTimesAArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">gradvTimesA</span><span class="p">));</span>
<a id="__codelineno-23-76" name="__codelineno-23-76" href="#__codelineno-23-76"></a>
<a id="__codelineno-23-77" name="__codelineno-23-77" href="#__codelineno-23-77"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xyzAlongv</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alongvAArgs</span><span class="p">);</span>
<a id="__codelineno-23-78" name="__codelineno-23-78" href="#__codelineno-23-78"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonguAArgs</span><span class="p">);</span>
<a id="__codelineno-23-79" name="__codelineno-23-79" href="#__codelineno-23-79"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_c0c1AlongGraduTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonggraduTimesAArgs</span><span class="p">);</span>
<a id="__codelineno-23-80" name="__codelineno-23-80" href="#__codelineno-23-80"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_c0c1AlongGradvTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alonggradvTimesAArgs</span><span class="p">);</span>
<a id="__codelineno-23-81" name="__codelineno-23-81" href="#__codelineno-23-81"></a><span class="w">          </span><span class="k">decltype</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">u_xyzAlongv</span><span class="p">))</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-23-82" name="__codelineno-23-82" href="#__codelineno-23-82"></a>
<a id="__codelineno-23-83" name="__codelineno-23-83" href="#__codelineno-23-83"></a><span class="w">          </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_xyzAlongv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_c0c1AlongGraduTimesA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_c0c1AlongGradvTimesA</span><span class="p">;</span>
<a id="__codelineno-23-84" name="__codelineno-23-84" href="#__codelineno-23-84"></a><span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDim</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-23-85" name="__codelineno-23-85" href="#__codelineno-23-85"></a><span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">u_c1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradv_c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_c1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradu_c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_c0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradu_c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-23-86" name="__codelineno-23-86" href="#__codelineno-23-86"></a><span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_c0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradv_c1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-23-87" name="__codelineno-23-87" href="#__codelineno-23-87"></a><span class="w">                   </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-23-88" name="__codelineno-23-88" href="#__codelineno-23-88"></a>
<a id="__codelineno-23-89" name="__codelineno-23-89" href="#__codelineno-23-89"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-23-90" name="__codelineno-23-90" href="#__codelineno-23-90"></a>
<a id="__codelineno-23-91" name="__codelineno-23-91" href="#__codelineno-23-91"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-92" name="__codelineno-23-92" href="#__codelineno-23-92"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-23-93" name="__codelineno-23-93" href="#__codelineno-23-93"></a><span class="w">    </span><span class="p">}</span>
</code></pre></div>
<ol>
<li>Compile-time branch for first-order derivatives</li>
<li>Evaluates the derivative of <code>this-&gt;l()</code> in relation to the only derivative contained within the local function arguments <code>lfArgs</code>.</li>
<li>Evaluates the return value; derivatives and function values are combined as dictated by the product rule.</li>
<li>Compile-time branch for second-order derivatives</li>
<li>We have four cases for evaluating functions because we are in the second-order derivatives branch: the function value, the function
   derivative w.r.t. the first argument or the second argument, and the function's derivative w.r.t. both arguments.
   Here, the function <code>evaluateFirstOrderDerivativesImpl</code> returns the derivatives w.r.t. the first argument and the second argument.
   If we consider the left function as <span class="arithmatex">\(\boldsymbol{u}(\boldsymbol{\xi},\boldsymbol{u}_I)\)</span>, this calls returns
   \begin{flalign*}
   \verb+u_x+ &amp;= \frac{\partial\boldsymbol{u}}{\partial\boldsymbol{\xi}} \quad \text{or} \quad \verb+u_x+ = \frac{\partial\boldsymbol{u}}
   {\partial\xi_0} \quad \text{or} \quad \verb+u_x+ = \frac{\partial\boldsymbol{u}}{\partial\boldsymbol{u}_I}\\
   \verb+u_y+ &amp;= \frac{\partial\boldsymbol{u}}{\partial\boldsymbol{u}_J}
   \end{flalign*}
   The first one would be returned if it is called as</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
</code></pre></div>
<p>and the second one if it is called as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
</code></pre></div>
<p>and the third without any spatial derivative is returned using</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)));</span>
</code></pre></div>
<p>Therefore, this function separates the two <code>wrt</code> arguments and returns the corresponding first order derivatives.
6. Compile-time branch for the case where no spatial derivatives are requested but only the derivatives w.r.t. coefficients are needed.
7. Creates a new argument variable where the <code>along</code> argument is replaced by <code>v</code>.
8. This function evaluates the derivatives of <code>l</code> w.r.t. to both <code>wrt</code> arguments. Furthermore, it takes the <code>along</code> argument since
   otherwise the returned object would be a 3-dimensional array.
   If we consider the left function as <span class="arithmatex">\(\boldsymbol{u}(\boldsymbol{\xi},\boldsymbol{u}_I)\)</span>  and <span class="arithmatex">\(\boldsymbol{v}\)</span> of the same size as
   <span class="arithmatex">\(\boldsymbol{u}\)</span> this calls returns
   \begin{flalign*}
   \verb+u_xyAlongv + &amp;= \frac{\partial^2 u_i }{\partial\boldsymbol{u}_I\partial\boldsymbol{u}_J} v_i
   \end{flalign*}
   This is the same if the following is called:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span>
</code></pre></div>
<ol>
<li>Compile-time branch for the case where one spatial derivative and one derivative w.r.t. the coefficients is needed.</li>
<li>
<p>This function evaluates the derivatives of <code>l</code> w.r.t. to both <code>wrt</code> arguments.
   If we consider the left function as <span class="arithmatex">\(\boldsymbol{u}(\boldsymbol{\xi},\boldsymbol{u}_I)\)</span>  this calls returns
   \begin{flalign*}
   \verb+u_xy+ &amp;= \frac{\partial^2 \boldsymbol{u} }{\partial\boldsymbol{\xi}\partial\boldsymbol{u}_I}
   \quad \text{or} \quad \verb+u_xy+ = \frac{\partial^2 \boldsymbol{u} }{\partial\xi_0\partial\boldsymbol{u}_I}
   \end{flalign*}
   The first one would be returned if it is called as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="w">   </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
</code></pre></div>
<p>and the second one if it is called as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
</code></pre></div>
<p>In the first case the result is stored in an array. Thus, in the first index, the derivative w.r.t. to the first spatial coordinate is stored.
Therefore, we have</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">spatialAllCoeffDeriv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">spatialAllCoeffDeriv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="c1">// derivative as in u.evaluateDerivative(gpIndex, wrt(spatial(0),coeff(i)));</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">spatialAllCoeffDeriv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="c1">// derivative as in u.evaluateDerivative(gpIndex, wrt(spatial(1),coeff(i)));</span>
</code></pre></div>
</li>
<li>
<p>Compile-time branch for the case where one single spatial derivatives and one derivative w.r.t. coefficients is needed.</p>
</li>
<li>Compile-time branch for the case where all spatial derivatives and one derivative w.r.t. coefficients is needed.</li>
<li>The return type here is an array of single spatial derivatives and each derived w.r.t. the coefficient. Thus, the type inside the
    array must be deduced here.</li>
<li>Compile-time branch for third order derivatives</li>
<li>Compile-time branch for single spatial derivatives</li>
<li>
<p>To obtain derivatives w.r.t. to the second and third <code>wrt</code> argument, we extract the arguments here. E.g., for the following request:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span>
</code></pre></div>
<p>This call would extract the arguments as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">newArgs</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;wrt(coeff(i,j)),along(matrix))&quot;</span><span class="w"> </span><span class="c1">//THIS IS NO VALID SYNTAX</span>
</code></pre></div>
<p>This can then be used as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">newArgs</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p>As in the second order derivative case, it returns all the three first order derivatives. E.g., for the case,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span>
</code></pre></div>
<p>the returned values would be
\begin{flalign*}
\verb+u_x+ &amp;= \frac{\partial \boldsymbol{u} }{\partial\boldsymbol{\xi}} \\
\verb+u_y+ &amp;= \frac{\partial \boldsymbol{u} }{\partial\boldsymbol{u}_I} \\
\verb+u_z+ &amp;= \frac{\partial \boldsymbol{u} }{\partial\boldsymbol{u}_J}
\end{flalign*}
18. This returns the derivatives w.r.t. the given spatial direction and w.r.t. the first and second coefficient.  E.g., for the case,</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span>
</code></pre></div>
<p>the returned values would be
\begin{flalign*}
\verb+u_xy+ &amp;= \frac{\partial^2 \boldsymbol{u} }{\partial\boldsymbol{\xi}\partial\boldsymbol{u}_I} \\
\verb+u_xz+ &amp;= \frac{\partial^2 \boldsymbol{u} }{\partial\boldsymbol{\xi}\partial\boldsymbol{u}_J} \\
\end{flalign*}
19. Creates a new argument variable where the <code>along</code> argument is replaced by <code>v_x</code>.
20. This return call would be</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span>
</code></pre></div>
<p>In mathematical notation, it returns
\begin{flalign*}
\verb+u_xyzAlongv  + &amp;= \frac{\partial^3 u_i }{\partial \xi_0\partial\boldsymbol{u}_I\partial\boldsymbol{u}_J} v_i
\end{flalign*}
21. This return would be</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">v_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">u_yzAlongvx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">along</span><span class="p">(</span><span class="n">v_x</span><span class="p">));</span>
</code></pre></div>
<p>In mathematical notation, it returns
\begin{flalign*}
\verb+u_yzAlongvx+ &amp;= \frac{\partial^2 u_i }{\partial\boldsymbol{u}_I\partial\boldsymbol{u}_J} \left[\frac{\partial \boldsymbol{v}}{\xi_0}\right]_i
\end{flalign*}
22. Compile-time branch for all spatial derivatives
23. Obtain the <code>along</code> argument defined, for example, in</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span>
</code></pre></div>
</li>
<li>
<p>Similar to the single spatial case</p>
</li>
<li>Similar to the single spatial case</li>
</ol>
<p>If your expression is working, it can be added to <code>dune/localfefunctions/expressions.hh</code> by submitting a PR
to <a href="https://github.com/ikarus-project/dune-localfefunctions">dune-localfefunctions</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:sander2020dune">
<p>Oliver Sander. <em>DUNE—The Distributed and Unified Numerics Environment</em>. Volume 140. Springer Nature, 2020. <a href="https://doi.org/10.1007/978-3-030-59702-3">doi:10.1007/978-3-030-59702-3</a>.&#160;<a class="footnote-backref" href="#fnref:sander2020dune" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:grohs_ProjectionBasedFinite2019">
<p>Philipp Grohs, Hanne Hardering, Oliver Sander, and Markus Sprecher. Projection-based finite elements for nonlinear function spaces. <em>SIAM J Numer Anal</em>, 57(1):404&ndash;428, 2019. <a href="https://doi.org/10.1137/18M1176798">doi:10.1137/18M1176798</a>.&#160;<a class="footnote-backref" href="#fnref:grohs_ProjectionBasedFinite2019" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 The Ikarus Developers
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs Insiders
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/Uni_Stgt_IBB" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/uni-stuttgart-ibb" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/repository/docker/ikarusproject/ikarus" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://gitter.im/ikarus-project/community" target="_blank" rel="noopener" title="gitter.im" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M66.4 322.5H16V0h50.4zM166.9 76.1h-50.4V512h50.4zm100.6 0h-50.4V512h50.4zM368 76h-50.4v247H368z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "content.code.annotate", "navigation.tabs", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.indexes", "toc.follow", "navigation.top"], "search": "../../assets/javascripts/workers/search.c7c1ca2c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.66941efb.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>