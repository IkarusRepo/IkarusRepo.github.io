
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Ikarus documentation.">
      
      
        <meta name="author" content="The Ikarus Developers">
      
      
        <link rel="canonical" href="https://IkarusRepo.github.io/01_theory/localFunctions/">
      
      <link rel="icon" href="../../images/logo_dummy.svg">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Local functions - Ikarus</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.08040f6c.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="pink">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#local-functions" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Ikarus" class="md-header__button md-logo" aria-label="Ikarus" data-md-component="logo">
      
  <img src="../../images/logo_white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ikarus
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Local functions
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="light-blue" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/IkarusRepo/Ikarus" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    IkarusRepo/Ikarus
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Ikarus" class="md-nav__button md-logo" aria-label="Ikarus" data-md-component="logo">
      
  <img src="../../images/logo_white.svg" alt="logo">

    </a>
    Ikarus
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/IkarusRepo/Ikarus" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    IkarusRepo/Ikarus
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../download/" class="md-nav__link">
        Download
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          How to contribute
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="How to contribute" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          How to contribute
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../openTask/" class="md-nav__link">
        Open Tasks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../codeStyle/" class="md-nav__link">
        Code style
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/howToEdit/" class="md-nav__link">
        How to edit the documentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../documentation/BuildTheDocumentationLocally/" class="md-nav__link">
        Build the documentation locally
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tutorialsOverview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Theory and Class Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Theory and Class Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Theory and Class Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../geometry/" class="md-nav__link">
        Geometry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../grid/" class="md-nav__link">
        Grid
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../feRequirements/" class="md-nav__link">
        FE requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../finiteElements/" class="md-nav__link">
        Finite Elements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../assembler/" class="md-nav__link">
        Assembler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../nonlinearOperator/" class="md-nav__link">
        NonlinearOperator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../controlRoutines/" class="md-nav__link">
        Control routines
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../localBasis/" class="md-nav__link">
        Local basis
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Local functions
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Local functions
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#interface" class="md-nav__link">
    Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients" class="md-nav__link">
    Derivatives w.r.t. coefficients
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients-and-spatial-derivatives" class="md-nav__link">
    Derivatives w.r.t. coefficients and spatial derivatives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dirichlet-energy" class="md-nav__link">
    Example Dirichlet energy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementations" class="md-nav__link">
    Implementations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-implement-your-own-local-functions" class="md-nav__link">
    How to implement your own local functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    Expressions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../manifolds/" class="md-nav__link">
        Manifolds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../solvers/" class="md-nav__link">
        Solvers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../observer/" class="md-nav__link">
        Observer and observables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../globalBasis/" class="md-nav__link">
        Global basis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../99_Literature/99_Literature/" class="md-nav__link">
        Literature
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cppRef/" class="md-nav__link">
        C++ recommendations
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../AdvancedTopics/" class="md-nav__link">
        Advanced Topics
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../02_gallery/gallery/" class="md-nav__link">
        Gallery
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#interface" class="md-nav__link">
    Interface
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients" class="md-nav__link">
    Derivatives w.r.t. coefficients
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#derivatives-wrt-coefficients-and-spatial-derivatives" class="md-nav__link">
    Derivatives w.r.t. coefficients and spatial derivatives
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-dirichlet-energy" class="md-nav__link">
    Example Dirichlet energy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementations" class="md-nav__link">
    Implementations
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-to-implement-your-own-local-functions" class="md-nav__link">
    How to implement your own local functions
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    Expressions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/IkarusRepo/Ikarus/edit/master/docs/01_theory/localFunctions.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="local-functions">Local functions<a class="headerlink" href="#local-functions" title="Permanent link">&para;</a></h1>
<p>This section explains the concept of local functions.</p>
<p>Local functions are functions which are bound to single grid elements.
Therefore they are constructed from some local basis and a coefficient vector.</p>
<p>Usually local functions need to be evaluated in the local coordinate system <span class="arithmatex">\( \mathbb{\xi} \in T_{\text{ref}} \subset\mathbb{R}^n \)</span> :</p>
<div class="arithmatex">\[
f: \boldsymbol{\xi}^n \rightarrow \mathbb{R}^m
\]</div>
<p>where <span class="arithmatex">\(T_{\text{ref}}\)</span> is the reference element, e.g. for a cube <span class="arithmatex">\(T_{\text{ref}}= [0,1]^d\)</span>.</p>
<h2 id="interface">Interface<a class="headerlink" href="#interface" title="Permanent link">&para;</a></h2>
<p>Local functions provide the following interface
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">FunctionReturnType</span><span class="w"> </span><span class="nf">evaluateFunction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">local</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">FunctionReturnType</span><span class="w"> </span><span class="nf">evaluateFunction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">integrationPointIndex</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">DomainType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">local</span><span class="p">,...);</span><span class="w"> </span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">integrationPointIndex</span><span class="p">,...);</span><span class="w"> </span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="k">auto</span><span class="w"> </span><span class="n">viewOverIntegrationPoints</span><span class="p">();</span><span class="w"> </span><span class="c1">// (1) </span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">order</span><span class="p">(</span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// (2) </span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">auto</span><span class="w"> </span><span class="n">basis</span><span class="p">(</span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="c1">// (3) </span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="k">auto</span><span class="w"> </span><span class="n">coefficientsRef</span><span class="p">(</span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (4) </span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">IntegrationRule</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Ints</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="kt">void</span><span class="w"> </span><span class="n">bind</span><span class="p">(</span><span class="n">IntegrationRule</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p_rule</span><span class="p">,</span><span class="w"> </span><span class="n">Derivatives</span><span class="o">&lt;</span><span class="n">Ints</span><span class="p">...</span><span class="o">&gt;&amp;&amp;</span><span class="w"> </span><span class="n">ints</span><span class="p">);</span><span class="w"> </span><span class="c1">// (5) </span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="k">auto</span><span class="w"> </span><span class="n">clone</span><span class="w"> </span><span class="p">();</span><span class="w"> </span><span class="c1">// (6) </span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">ScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="k">auto</span><span class="w"> </span><span class="n">rebindClone</span><span class="w"> </span><span class="p">(</span><span class="n">ScalarType</span><span class="p">,</span><span class="w"> </span><span class="n">Dune</span><span class="o">::</span><span class="n">index_constant</span><span class="o">&lt;</span><span class="n">ID</span><span class="o">&gt;</span><span class="p">);</span><span class="w"> </span><span class="c1">// (7) </span>
</code></pre></div></p>
<ol>
<li>This returns a vector of structs of the integration point and its index. Therefore the syntax is usually <code class="highlight"><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{...}</span><span class="w"></span></code></li>
<li>Return the order of the local function wrt. the coefficients. An id tag can be passed which returns the order wrt a tagged function. For details see <a href="#tagging-leaf-local-functions">Tagging leaf local functions</a>.</li>
<li>Return the basis of the local function. An id tag can be passed which returns the basis of a specific tagged function. For details see <a href="#tagging-leaf-local-functions">Tagging leaf local functions</a>.</li>
<li>Returns a reference to the coefficient of the underlying leaf local finite elements. An id tag can be passed which returns the basis of a specific tagged function. It can return const and non-const reference. The non-const version is deactivated, if there are more than one leaf node with the passed id tag.  For details see <a href="#tagging-leaf-local-functions">Tagging leaf local functions</a>.</li>
<li>This function is passed through to the given <code>localBasis</code>. See <a href="../localBasis/">Link</a></li>
<li>Clones the local function and stores a copy of all leave nodes.</li>
<li>Clones the local function and rebinds the scalar type of the coefficients with id tag ID. This becomes hand, if you want to replace doubles with an autodiff type.</li>
</ol>
<p>The "..." in the <code>evaluateDerivative</code> function call are several variadic templates.
In action this looks like</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Usage with integration point index</label><label for="__tabbed_1_2">using integration point coordinates</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Ikarus</span><span class="o">::</span><span class="nn">DerivativeDirections</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">rule</span><span class="p">,</span><span class="w"> </span><span class="n">bindDerivatives</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">));</span><span class="w">     </span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">()){</span><span class="w"> </span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">));</span><span class="w"> </span><span class="c1">// (1) </span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">));</span><span class="w"> </span><span class="c1">// (2) </span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ol>
<li>Compute the spatial Jacobian of localFunction </li>
<li>Compute the spatial Jacobian of localFunction and transform it to physical coordinates </li>
</ol>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Ikarus</span><span class="o">::</span><span class="nn">DerivativeDirections</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">gp</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">rule</span><span class="p">){</span><span class="w"> </span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">(),</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">));</span><span class="w"> </span><span class="c1">// (1) </span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gp</span><span class="p">.</span><span class="n">position</span><span class="p">(),</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">));</span><span class="w"> </span><span class="c1">// (2) </span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ol>
<li>Compute the spatial Jacobian of localFunction </li>
<li>Compute the spatial Jacobian of localFunction and transform it to physical coordinates </li>
</ol>
</div>
</div>
</div>
<p>where the first call implements</p>
<div class="arithmatex">\[
\operatorname{grad}_\boldsymbol{\xi} f : \boldsymbol{\xi} \rightarrow \mathbb{R}^{m \times d}.
\]</div>
<p>The second one respect the fact that the local function in reality is defined in some physical space <span class="arithmatex">\(X\)</span> with the coordinate <span class="arithmatex">\(\boldsymbol{x}\)</span>.
Therefore, it transforms the Jacobian from the reference element <span class="arithmatex">\(\operatorname{grad}_{\boldsymbol{\xi}}\)</span> to the Jacobian in physical space <span class="arithmatex">\(\operatorname{grad}_\boldsymbol{x}\)</span> . E.g. it usually implements</p>
<div class="arithmatex">\[
\operatorname{grad}_\boldsymbol{x} = \operatorname{grad}_{\boldsymbol{\xi}} \boldsymbol{J}^{-1}  
\]</div>
<p>where <span class="arithmatex">\(J\)</span> is the Jacobian of the mapping from the reference element <span class="arithmatex">\(T_{\text{ref}}\)</span> to the element living in physical space <span class="arithmatex">\(T\)</span>.
For details see <sup id="fnref:1"><a class="footnote-ref" href="#fn:1">2</a></sup> page 22.</p>
<p>Instead of passing <code>spatialAll</code> to <code>wrt(..)</code>, there are other helper such as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">)));</span><span class="w"> </span><span class="c1">// (1)  </span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">1</span><span class="p">)));</span><span class="w"> </span><span class="c1">// (2) </span>
</code></pre></div>
<ol>
<li>Compute the first column of the spatial Jacobian of localFunction</li>
<li>Compute the second column of the spatial Jacobian of localFunction</li>
</ol>
<p>which can also be combined with <code>transformWith(Jinv)</code>.</p>
<h2 id="derivatives-wrt-coefficients">Derivatives w.r.t. coefficients<a class="headerlink" href="#derivatives-wrt-coefficients" title="Permanent link">&para;</a></h2>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div>
which implements for a in vector space valued function (steeming from interpolation),e.g. <span class="arithmatex">\(f(\boldsymbol{\xi}) = \sum_{I=1}^n N^I(\boldsymbol{\xi}) \boldsymbol{x}_I\)</span> the following</p>
<div class="arithmatex">\[
[\boldsymbol{A}]_{ij}  = A_{ij} =  \frac{\partial f_i(\boldsymbol{\xi})}{\partial \boldsymbol{x}_j}
\]</div>
<p>and the second derivative</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">)),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">q</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
<div class="arithmatex">\[
[\boldsymbol{B}]_{jk} =  B_{jk} = q_i A_{ijk} =  \frac{\partial^2 (q_i  f_i(\boldsymbol{\xi}))}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}
\]</div>
<p>where <span class="arithmatex">\(\boldsymbol{q}\)</span> is an arbitrary vector of the same size as <span class="arithmatex">\(f\)</span>, i.e. it is the direction of the derivative in this case. $ \boldsymbol{A} $ and $ \boldsymbol{B} $ is simply the returned matrix and they do not have a special meaning. If we would not pass the vector the result would be a third order tensor for a vector valued function <span class="arithmatex">\(f\)</span>.
Therefore the simply return a matrix. This helps for readablilty and for speed. See the <a href="#example-dirichlet-energy">example</a> for details.</p>
<h2 id="derivatives-wrt-coefficients-and-spatial-derivatives">Derivatives w.r.t. coefficients and spatial derivatives<a class="headerlink" href="#derivatives-wrt-coefficients-and-spatial-derivatives" title="Permanent link">&para;</a></h2>
<p>Spatial derivatives and derivatives w.r.t. the coefficients can be combined. Therefore, it is legal to call</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">Q</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">b1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">q</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">b2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatial</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">q</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>The order of spatial and coeff derivatives does not matter. The returned value is always re-arranged that the first derivative is the spatial one.</p>
<p>The first line is then equivalent to</p>
<div class="arithmatex">\[
[\boldsymbol{B}]_{jk} =  B_{jk} = Q_{il} A_{iljk} =  \frac{\partial^2 ([\operatorname{grad}_\boldsymbol{\xi} f(\boldsymbol{\xi})]_{il} Q_{il} )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}.
\]</div>
<p>For the second and third line we have</p>
<div class="arithmatex">\[\begin{align}
\boldsymbol{b}_{0,jk} = \frac{\partial^2 ([\operatorname{grad}_{\xi^0} f(\xi)]_{i} q_i )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}, \\
\boldsymbol{b}_{1,jk} = \frac{\partial^2 ([\operatorname{grad}_{\xi^1} f(\xi)]_{i} q_i )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}.
\end{align}\]</div>
<p>These objects are also returned when the second and third line above are used.</p>
<p>Again all of these function calls can be combined with <code>transformWith()</code> as</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">localFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">),</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">Q</span><span class="p">),</span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
<p>which computes</p>
<div class="arithmatex">\[
\frac{\partial^2 ([\operatorname{grad}_\boldsymbol{x} f(\boldsymbol{\xi})]_{il} Q_{il} )}{\partial \boldsymbol{x}_j\partial \boldsymbol{x}_k}.
\]</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>Currently only first order spatial derivatives and second order derivatives w.r.t. the coefficients are supported.</p>
<h2 id="example-dirichlet-energy">Example Dirichlet energy<a class="headerlink" href="#example-dirichlet-energy" title="Permanent link">&para;</a></h2>
<p>This examples shows how the energy, gradient and Hessian of a <a href="https://en.wikipedia.org/wiki/Dirichlet_energy">dirichlet energy</a> can be calculated.
$$
E(\boldsymbol{u}) = \frac{1}{2} \int_\Omega ||\operatorname{grad}_\boldsymbol{x} \boldsymbol{u}(\boldsymbol{x})|| ^2 \textrm{d} \boldsymbol{x}
$$</p>
<p>If we want to mimize this energy w.r.t. the coefficients of the nodes, we need to calculate the energy, gradient and the Hessia w.r.t. the coefficients.<br />
Of course this depends on the optimization algorithms, but for now lets keep it simple.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">dirichletEnergy</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">energy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="c1">//... bind localBasis to some integration rule </span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="c1">// and create uNodalCoeffs </span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="w"> </span><span class="nf">uFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">uNodalCoeffs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="c1">//.. calculate the inverse Jacobian of the geometry </span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gradu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="n">energy</span><span class="o">+=</span><span class="w"> </span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">gradu</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="o">*</span><span class="n">gradu</span><span class="p">).</span><span class="n">trace</span><span class="p">()</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;weight from integration point and geo.integrationElement&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">gradientDirichletEnergy</span><span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span><span class="w"> </span><span class="n">g</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span><span class="c1">//... bind localBasis to some integration rule </span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">  </span><span class="c1">// and create uNodalCoeffs </span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="c1">// spatial size of u </span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">      </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="w"> </span><span class="n">uFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">uNodalCoeffs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="c1">//.. calculate the inverse Jacobian of the geometry </span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gradu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">),</span><span class="w"> </span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//loop over coeffs, i.e.nodes of the finite element </span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduDCoeffs</span><span class="w"> </span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="w"> </span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="w"> </span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">      </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">      </span><span class="n">tmp</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDimension</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">        </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">graduDCoeffs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradu</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">k</span><span class="p">);</span><span class="w">  </span><span class="c1">// (1) </span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">      </span><span class="n">g</span><span class="p">.</span><span class="n">segment</span><span class="o">&lt;</span><span class="n">size</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;weight from integration point and geo.integrationElement&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ol>
<li><code>graduDCoeffs</code> contains in <code>graduDCoeffs[0]</code> the derivatives w.r.t.the coefficient of the first column and at <code>[1]</code> w.r.t.the second column of <code>gradu</code></li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">hessianDirichletEnergy</span><span class="p">(</span><span class="n">Matrix</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="c1">//... bind localBasis to some integration rule </span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="c1">// and create uNodalCoeffs </span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="c1">// spatial size of u </span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">      </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="w"> </span><span class="n">uFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">uNodalCoeffs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="c1">//.. calculate the inverse Jacobian of the geometry </span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">coeffs</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">.</span><span class="n">e</span><span class="p">.</span><span class="n">nodes</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">finite</span><span class="w"> </span><span class="n">element</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduDCoeffsI</span><span class="w"> </span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="w"> </span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)),</span><span class="w"> </span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">fe</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">//loop over coeffs, i.e.nodes of the finite element </span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduDCoeffsJ</span><span class="w"> </span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">uFunction</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="w"> </span><span class="n">coeffs</span><span class="p">),</span><span class="w"> </span><span class="n">transformWith</span><span class="p">(</span><span class="n">Jinv</span><span class="p">),</span><span class="w"> </span><span class="n">coeffIndices</span><span class="p">(</span><span class="n">j</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">        </span><span class="n">Eigen</span><span class="o">::</span><span class="n">Matrix</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tmp</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">        </span><span class="n">tmp</span><span class="p">.</span><span class="n">setZero</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDimension</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">k</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">          </span><span class="n">tmp</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">graduDCoeffsI</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">graduDCoeffsJ</span><span class="p">[</span><span class="n">k</span><span class="p">];</span><span class="w"> </span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">        </span><span class="n">h</span><span class="p">.</span><span class="n">block</span><span class="o">&lt;</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tmp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;weight from integration point and geo.integrationElement&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<h2 id="implementations">Implementations<a class="headerlink" href="#implementations" title="Permanent link">&para;</a></h2>
<p>In the following we summarize the local functions that are currently available.
In the following table <span class="arithmatex">\(N^i(\boldsymbol{\xi})\)</span> are the ansatz functions.</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Interpolation formula</th>
<th align="left">Note</th>
<th>Header</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Standard</td>
<td align="left">$$ \boldsymbol{x} = \sum_{i=1}^n N^i(\boldsymbol{\xi}) \boldsymbol{x}_i  $$</td>
<td align="left"></td>
<td><code>standardLocalFunction.hh</code></td>
</tr>
<tr>
<td align="left">Projection-Based<sup id="fnref:2"><a class="footnote-ref" href="#fn:2">3</a></sup></td>
<td align="left">$$ \boldsymbol{x} = P\left(\sum_{i=1}^n N^i(\boldsymbol{\xi}) \boldsymbol{x}_i \right) $$</td>
<td align="left">This is one version of geometric finite elements. These are finite elements suited for interpolation on manifolds. Here <span class="arithmatex">\(P: \mathbb{R}^m \rightarrow \mathcal{M}\)</span> is an operator that projects <br /> the usual linear interpolation onto some manifold</td>
<td><code>projectionBasedLocalFunction.hh</code></td>
</tr>
</tbody>
</table>
<h2 id="how-to-implement-your-own-local-functions">How to implement your own local functions<a class="headerlink" href="#how-to-implement-your-own-local-functions" title="Permanent link">&para;</a></h2>
<p>If you are interested in implementing your own local function we have prepared the file
<a href="https://github.com/IkarusRepo/Ikarus/src/include/ikarus/localFunctions/impl/localFunctionTemplate.hh"><code>ikarus/localFunctions/impl/localFunctionTemplate.hh</code></a>.</p>
<p>You can copy the file rename the class to your preferred name and then implement the following functions. If you don't need a function you need to delete the corresponding function.
Then if someone calls the corresponding derivative returns a zero matrix.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">FunctionReturnType</span><span class="w"> </span><span class="nf">evaluateEmbeddingFunctionImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Eigen</span><span class="o">::</span><span class="n">VectorXd</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">FunctionReturnType</span><span class="p">{};</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="c1">// (0) </span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">Jacobian</span><span class="w"> </span><span class="nf">evaluateDerivativeWRTSpaceAllImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">                                           </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dN</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (1) </span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="n">JacobianColType</span><span class="w"> </span><span class="nf">evaluateDerivativeWRTSpaceSingleImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">                                                     </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dN</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">                                                     </span><span class="kt">int</span><span class="w"> </span><span class="n">spaceIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (2) </span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="n">CoeffDerivMatrix</span><span class="w"> </span><span class="nf">evaluateDerivativeWRTCoeffsImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">                                                 </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dN</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">                                                 </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (3) </span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="n">CoeffDerivMatrix</span><span class="w"> </span><span class="nf">evaluateSecondDerivativeWRTCoeffs</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">                                                   </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">                                                   </span><span class="k">const</span><span class="w"> </span><span class="n">AlongType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">along</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">                                                   </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">gridDim</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (4) </span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">CoeffDerivMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">gridDim</span><span class="o">&gt;</span><span class="w">  </span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">        </span><span class="n">evaluateDerivativeWRTCoeffsANDSpatialImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">                                                  </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dN</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">                                                  </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (5) </span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="n">CoeffDerivMatrix</span><span class="w"> </span><span class="n">evaluateDerivativeWRTCoeffsANDSpatialSingleImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a><span class="w">                                                                 </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dN</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">                                                                 </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a><span class="w">                                                                 </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">spatialIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (6) </span>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="n">CoeffDerivMatrix</span><span class="w">  </span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="w">        </span><span class="n">evaluateThirdDerivativeWRTCoeffsTwoTimesAndSpatialImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">                                                               </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dN</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="w">                                                               </span><span class="k">const</span><span class="w"> </span><span class="n">AlongType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">along</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a><span class="w">                                                               </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">gridDim</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="w"> </span>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="w">                                                               </span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (7) </span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="n">CoeffDerivMatrix</span><span class="w">  </span>
<a id="__codelineno-11-40" name="__codelineno-11-40" href="#__codelineno-11-40"></a><span class="w">        </span><span class="n">evaluateThirdDerivativeWRTCoeffsTwoTimesAndSpatialSingleImpl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-41" name="__codelineno-11-41" href="#__codelineno-11-41"></a><span class="w">                                                                     </span><span class="k">const</span><span class="w"> </span><span class="n">AnsatzFunctionJacobian</span><span class="o">&amp;</span><span class="w"> </span><span class="n">dN</span><span class="p">,</span><span class="w">  </span>
<a id="__codelineno-11-42" name="__codelineno-11-42" href="#__codelineno-11-42"></a><span class="w">                                                                     </span><span class="k">const</span><span class="w"> </span><span class="n">AlongType</span><span class="o">&amp;</span><span class="w"> </span><span class="n">along</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-11-43" name="__codelineno-11-43" href="#__codelineno-11-43"></a><span class="w">                                                                     </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">gridDim</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">coeffsIndex</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span>
<a id="__codelineno-11-44" name="__codelineno-11-44" href="#__codelineno-11-44"></a><span class="w">                                                                     </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">spatialIndex</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{...}</span><span class="w"> </span><span class="c1">// (8) </span>
</code></pre></div>
<ol>
<li>This is called by <code>localFunction.evaluateFunction(...)</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatialAll))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatial(i)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(coeff(j)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(coeff(j,k)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatialAll,coeff(j)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatial(i),coeff(j)))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatialAll,coeff(j,k)), along(A))</code>.</li>
<li>This is called by <code>localFunction.evaluateDerivative(..., wrt(spatial(i),coeff(j,k)), along(v))</code>.</li>
</ol>
<h2 id="expressions">Expressions<a class="headerlink" href="#expressions" title="Permanent link">&para;</a></h2>
<p>We use expression templates<sup id="fnref:et"><a class="footnote-ref" href="#fn:et">1</a></sup> to combine existing local functions to obtain new nested ones.</p>
<p>For example consider the following code
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">);</span><span class="w"> </span>
</code></pre></div>
we create here two local functions that satisfy the interface described above.<br />
Now it is possible to combine these functions and get an object that also satisfies the concept above.
Thus the following is possible:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="p">...</span><span class="w"> </span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="o">+</span><span class="n">g</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">spatial</span><span class="p">(</span><span class="n">d</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div></p>
<p>Currently, we support binary and unary expressions. The following expressions are defined:</p>
<table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Mathematical formula</th>
<th align="left">Code</th>
<th align="left">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Sum</td>
<td align="left">$$ \boldsymbol{f} + \boldsymbol{g}  $$</td>
<td align="left"><code class="highlight"><span class="n">f</span><span class="o">+</span><span class="n">g</span><span class="w"></span></code></td>
<td align="left"><span class="arithmatex">\(\boldsymbol{f}\)</span>  and  <span class="arithmatex">\(\boldsymbol{g}\)</span> need to be the same size.</td>
</tr>
<tr>
<td align="left">DotProduct</td>
<td align="left">$$ \boldsymbol{f} \cdot \boldsymbol{g} = f_i g_i $$</td>
<td align="left"><code class="highlight"><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">)</span><span class="w"></span></code></td>
<td align="left"><span class="arithmatex">\(\boldsymbol{f}\)</span>  and  <span class="arithmatex">\(\boldsymbol{g}\)</span> need to be the same size.</td>
</tr>
<tr>
<td align="left">normSquared</td>
<td align="left">$$ \boldsymbol{f} \cdot \boldsymbol{f} = f_i f_i $$</td>
<td align="left"><code class="highlight"><span class="n">normSquared</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"></span></code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Negate</td>
<td align="left">$$ -\boldsymbol{f}  $$</td>
<td align="left"><code class="highlight"><span class="o">-</span><span class="n">f</span><span class="w"></span></code></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">sqrt</td>
<td align="left">$$ \sqrt{f}  $$</td>
<td align="left"><code class="highlight"><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"></span></code></td>
<td align="left">The function <span class="arithmatex">\(f\)</span> needs a scalar return type.</td>
</tr>
<tr>
<td align="left">log</td>
<td align="left">$$ \log{f}  $$</td>
<td align="left"><code class="highlight">log(f)</code></td>
<td align="left">The function <span class="arithmatex">\(f\)</span> needs a scalar return type. Log is the natural logarithm.</td>
</tr>
<tr>
<td align="left">pow</td>
<td align="left">$$ f^n  $$</td>
<td align="left"><code class="highlight"><span class="n">pow</span><span class="o">&lt;</span><span class="n">n</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"></span></code></td>
<td align="left">The function <span class="arithmatex">\(f\)</span> needs a scalar return type. <span class="arithmatex">\(n\)</span> is an integer given at compile time.</td>
</tr>
<tr>
<td align="left">Scale</td>
<td align="left">$$  a f , \quad a \in  \mathbf{R}$$</td>
<td align="left"><code class="highlight"><span class="n">a</span><span class="o">*</span><span class="n">f</span><span class="w"></span></code> and <code class="highlight"><span class="n">f</span><span class="o">/</span><span class="n">a</span><span class="w"></span></code></td>
<td align="left"><code class="highlight"><span class="n">a</span><span class="w"></span></code> has to satisfy <code class="highlight"><span class="n">std</span><span class="o">::</span><span class="n">is_arithmetic</span><span class="o">&lt;</span><span class="p">..</span><span class="o">&gt;</span><span class="w"></span></code></td>
</tr>
</tbody>
</table>
<p>These expressions can be nested. Thus, it is valid to write something like
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">f</span><span class="o">+</span><span class="n">f</span><span class="p">,</span><span class="mi">5</span><span class="o">*</span><span class="n">g</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">spatial</span><span class="p">(</span><span class="n">d</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div></p>
<p>To use these expression there are addition exported static types for all expressions
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isLeaf</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1) </span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">children</span><span class="p">;</span><span class="w"> </span><span class="c1">// (2) </span>
</code></pre></div></p>
<ol>
<li>This is true if the underlying expression is one of the above Local functions that really contain the coefficients, see <a href="#implementations">Implementations</a>.</li>
<li>Returns the number of children. 2 for binary expressions and 1 for unary expressions.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use these expression you can simply include the header by <code class="highlight"><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ikarus/localFunctions/expressions.hh&gt;</span><span class="cp"></span></code>.</p>
</div>
<h1 id="tagging-leaf-local-functions">Tagging leaf local functions<a class="headerlink" href="#tagging-leaf-local-functions" title="Permanent link">&para;</a></h1>
<p>In the context of mixed finite elements. There are usually several local functions that contribute to the energy. These steems from different local basis.
For example consider the Q1P0 element where displacements are interpolated by using the four bilinear ansatz function and the the element-wise constant pressure field.</p>
<p>Thus we need to differentiate wrt. different coefficients. This can be done by tagging the local function by construction.
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">Indices</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis0</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">,</span><span class="mi">0</span><span class="n">_</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis1</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">,</span><span class="mi">1</span><span class="n">_</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="mi">0</span><span class="n">_</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="n">_</span><span class="p">,</span><span class="n">j</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div>
To explain the last line above lets consider that the function f is constructed as <span class="arithmatex">\(f= \sum_{I=0}^n N^I f_i\)</span> and similar<br />
<span class="arithmatex">\(g= \sum_{I=0}^m M^I g_i\)</span>, where <span class="arithmatex">\(N\)</span> and <span class="arithmatex">\(M\)</span> are some ansatz functions and <span class="arithmatex">\(f_I\)</span> and <span class="arithmatex">\(g_I\)</span> are nodal coefficients.</p>
<p>Thus the above call translates to</p>
<div class="arithmatex">\[\begin{align}
\boldsymbol{M}_{0,1}[J,K] = \frac{\partial^2 (f_{i} g_i )}{\partial \boldsymbol{f}_J\partial \boldsymbol{g}_K}.
\end{align}\]</div>
<p>If we would calculate the complete hessian of <span class="arithmatex">\(dot(f,g)\)</span> we can do this by</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">Indices</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">hessianDirichletEnergy</span><span class="p">(</span><span class="n">Matrix</span><span class="o">&amp;</span><span class="w"> </span><span class="n">h</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="w">  </span><span class="c1">//... bind localBasis to some integration rule </span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">Dune</span><span class="o">::</span><span class="nn">Indices</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis0</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">,</span><span class="mi">0</span><span class="n">_</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">StandardLocalFunction</span><span class="p">(</span><span class="n">localBasis1</span><span class="p">,</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">,</span><span class="mi">1</span><span class="n">_</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sizef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">correctionSize</span><span class="p">;</span><span class="w"> </span><span class="c1">// spatial size of the correction of the coefficients of f </span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sizeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g</span><span class="p">.</span><span class="n">correctionSize</span><span class="p">;</span><span class="w"> </span><span class="c1">// spatial size of the correction of the coefficients of g </span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffSizef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coeffVectors0</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">coeffVectors1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w">  </span><span class="n">Dune</span><span class="o">::</span><span class="n">MultiTypeBlockMatrix</span><span class="o">&lt;</span><span class="n">Dune</span><span class="o">::</span><span class="n">MultiTypeBlockVector</span><span class="o">&lt;</span><span class="n">MatrixBlock00</span><span class="p">,</span><span class="n">MatrixBlock01</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">                                       </span><span class="n">Dune</span><span class="o">::</span><span class="n">MultiTypeBlockVector</span><span class="o">&lt;</span><span class="n">MatrixBlock10</span><span class="p">,</span><span class="n">MatrixBlock11</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">KBlocked</span><span class="p">;</span><span class="w"> </span><span class="c1">// (1) </span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">gp</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">viewOverIntegrationPoints</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="mi">0</span><span class="n">_</span><span class="p">,</span><span class="mi">0</span><span class="n">_</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">sizef</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="mi">0</span><span class="n">_</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">0</span><span class="n">_</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;weight from integration point and geo.integrationElement&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="mi">0</span><span class="n">_</span><span class="p">,</span><span class="mi">1</span><span class="n">_</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">sizeg</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="mi">0</span><span class="n">_</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="n">_</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;weight from integration point and geo.integrationElement&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="mi">1</span><span class="n">_</span><span class="p">,</span><span class="mi">1</span><span class="n">_</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizeg</span><span class="p">,</span><span class="w"> </span><span class="n">sizeg</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="n">_</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">1</span><span class="n">_</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;weight from integration point and geo.integrationElement&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">I</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizeg</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">I</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">coeffSizef</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">J</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">        </span><span class="n">KBlocked</span><span class="p">[</span><span class="mi">1</span><span class="n">_</span><span class="p">,</span><span class="mi">0</span><span class="n">_</span><span class="p">].</span><span class="n">block</span><span class="o">&lt;</span><span class="n">sizef</span><span class="p">,</span><span class="w"> </span><span class="n">sizeg</span><span class="o">&gt;</span><span class="p">(</span><span class="n">I</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizeg</span><span class="p">,</span><span class="w"> </span><span class="n">J</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sizef</span><span class="p">)</span><span class="w">  </span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">          </span><span class="o">+=</span><span class="w"> </span><span class="n">k</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">ipIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="mi">1</span><span class="n">_</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="mi">0</span><span class="n">_</span><span class="p">,</span><span class="n">J</span><span class="p">)))</span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;weight from integration point and geo.integrationElement&quot;</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ol>
<li>This Block structure is not necessary. In this example all types (MatrixBlock00,MatrixBlock01,MatrixBlock10,MatrixBlock11) are considered as <code class="highlight"><span class="n">Eigen</span><span class="o">::</span><span class="n">MatrixXd</span><span class="w"></span></code>.</li>
</ol>
<h2 id="writing-your-own-expression">Writing your own expression<a class="headerlink" href="#writing-your-own-expression" title="Permanent link">&para;</a></h2>
<p>You can also write your own expressions. For this you can look into existing expressions. Especially the sqrt expression and the normSquared expression are the most general unary and binary expression</p>
<h1 id="implementing-the-return-value">Implementing the return value<a class="headerlink" href="#implementing-the-return-value" title="Permanent link">&para;</a></h1>
<p>If you want to implement your own expression you first have to implement the return value.
This is done using the function
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">LFArgs</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateValueOfExpression</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LFArgs</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lfArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span>
</code></pre></div></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>The interface dictates that the return value needs to be an Eigen type. Thus, even if you want to return a scalar <code class="highlight"><span class="kt">double</span><span class="w"></span></code> you have to wrap it in <code class="highlight"><span class="n">Eigen</span><span class="o">::</span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="o">&gt;</span><span class="w"></span></code></p>
<p>Additionally you also have to implement the derivative evaluation. This is done by implementing
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">DerivativeOrder</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">LFArgs</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivativeOfExpression</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LFArgs</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lfArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span><span class="w"> </span>
</code></pre></div></p>
<h1 id="evaluate-underlying-functions">Evaluate underlying functions<a class="headerlink" href="#evaluate-underlying-functions" title="Permanent link">&para;</a></h1>
<p>Expression always act on already given expression. Therefore, to return the correct quantity for your expression you have to evaluate the underlying quantities.
If you have a unary function you have access to expression using  <code class="highlight"><span class="k">this</span><span class="o">-&gt;</span><span class="n">m</span><span class="p">()</span><span class="w"></span></code> and for binary expressions this is <code class="highlight"><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">()</span><span class="w"></span></code> and <code class="highlight"><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">()</span><span class="w"></span></code>.</p>
<p>To evaluate these functions you can use the following syntax.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">mEvaluated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">m</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (1) </span>
</code></pre></div>
<ol>
<li>The syntax is the same for binary expression, e.g.
   <div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">l_Evaluated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">r_Evaluated</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
</code></pre></div></li>
</ol>
<p>The expression fulfill the syntax of a local function thus also derivative can be evaluated.</p>
<p>In the function <code>evaluateDerivativeOfExpression</code> the derivative order that the user wants is encoded in the template argument <code>DerivativeOrder</code>.
Additionally, the derivative types can also accessed using the booleans</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasTwoCoeff</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasSingleCoeff</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasNoCoeff</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasNoSpatial</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasOneSpatialAll</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasOneSpatialSingle</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">hasOneSpatial</span><span class="p">;</span><span class="w"> </span>
</code></pre></div>
<p>Using the dotproduct as binary example expression we have</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">DerivativeOrder</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">LFArgs</span><span class="o">&gt;</span><span class="w"> </span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">evaluateDerivativeOfExpression</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LFArgs</span><span class="w"> </span><span class="o">&amp;</span><span class="n">lfArgs</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">      </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFunctionImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">DerivativeOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1) </span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">      </span><span class="p">{</span><span class="w"> </span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (2) </span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">transpose</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_x</span><span class="p">);</span><span class="w"> </span><span class="c1">// (3) </span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">DerivativeOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">   </span><span class="c1">// (4) </span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">u_x</span><span class="p">,</span><span class="w"> </span><span class="n">u_y</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (5) </span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">v_x</span><span class="p">,</span><span class="w"> </span><span class="n">v_y</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasNoSpatial</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasTwoCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (6) </span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonguArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span><span class="w"> </span><span class="c1">// (7) </span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alongvArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">u</span><span class="p">));</span><span class="w">  </span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xyAlongv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alongvArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (8) </span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xyAlongu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonguArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">u_xyAlongv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_xyAlongu</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatial</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasSingleCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (9) </span>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (10) </span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialSingle</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasSingleCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (11) </span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_xy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_x</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span><span class="w"> </span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">                                </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_xy</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialAll</span><span class="w"> </span><span class="n">and</span><span class="w"> </span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasSingleCoeff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (12) </span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">remove_cvref_t</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">gridDim</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"> </span><span class="c1">// (13) </span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDim</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">              </span><span class="n">res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_xy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_x</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_x</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span><span class="w"> </span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">                                    </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_xy</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span><span class="w"> </span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">DerivativeOrder</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (14)                                      </span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialSingle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// (15) </span>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">.</span><span class="n">extractSecondWrtArgOrFirstNonSpatial</span><span class="p">();</span><span class="w"> </span><span class="c1">// (16) </span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">u_x</span><span class="p">,</span><span class="w"> </span><span class="n">u_y</span><span class="p">,</span><span class="w"> </span><span class="n">u_z</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (17) </span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">v_x</span><span class="p">,</span><span class="w"> </span><span class="n">v_y</span><span class="p">,</span><span class="w"> </span><span class="n">v_z</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">u_xy</span><span class="p">,</span><span class="w"> </span><span class="n">u_xz</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (18) </span>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">v_xy</span><span class="p">,</span><span class="w"> </span><span class="n">v_xz</span><span class="p">]</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonguArgs</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">u</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alongvArgs</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyzalongv_xArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">v_x</span><span class="p">));</span><span class="w"> </span><span class="c1">// (19) </span>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyzalongu_xArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">u_x</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>
<a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xyzAlongv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alongvArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (20) </span>
<a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonguArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_yzAlongvx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">argsForDyzalongv_xArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (21) </span>
<a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_yzAlongux</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">argsForDyzalongu_xArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>
<a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">Ikarus</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="n">u_xyzAlongv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_xy</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_xz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_yzAlongux</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_yzAlongvx</span><span class="w"> </span>
<a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a><span class="w">                              </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_xz</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_xy</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">u_z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">LFArgs</span><span class="o">::</span><span class="n">hasOneSpatialAll</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (22) </span>
<a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">alongMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">get</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">.</span><span class="n">alongArgs</span><span class="p">.</span><span class="n">args</span><span class="p">);</span><span class="w"> </span><span class="c1">// (23) </span>
<a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a>
<a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">uTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval</span><span class="p">(</span><span class="n">u</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">vTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eval</span><span class="p">(</span><span class="n">v</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a>
<a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradu</span><span class="p">,</span><span class="w"> </span><span class="n">u_c0</span><span class="p">,</span><span class="w"> </span><span class="n">u_c1</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (24) </span>
<a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradv</span><span class="p">,</span><span class="w"> </span><span class="n">v_c0</span><span class="p">,</span><span class="w"> </span><span class="n">v_c1</span><span class="p">]</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateFirstOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradu_c0</span><span class="p">,</span><span class="w"> </span><span class="n">gradu_c1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span><span class="c1">// (25) </span>
<a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">gradv_c0</span><span class="p">,</span><span class="w"> </span><span class="n">gradv_c1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateSecondOrderDerivativesImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-66" name="__codelineno-23-66" href="#__codelineno-23-66"></a>
<a id="__codelineno-23-67" name="__codelineno-23-67" href="#__codelineno-23-67"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">graduTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gradu</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">.</span><span class="n">transpose</span><span class="p">()).</span><span class="n">eval</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-23-68" name="__codelineno-23-68" href="#__codelineno-23-68"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">gradvTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">gradv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">.</span><span class="n">transpose</span><span class="p">()).</span><span class="n">eval</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-23-69" name="__codelineno-23-69" href="#__codelineno-23-69"></a>
<a id="__codelineno-23-70" name="__codelineno-23-70" href="#__codelineno-23-70"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">argsForDyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lfArgs</span><span class="p">.</span><span class="n">extractSecondWrtArgOrFirstNonSpatial</span><span class="p">();</span><span class="w"> </span>
<a id="__codelineno-23-71" name="__codelineno-23-71" href="#__codelineno-23-71"></a>
<a id="__codelineno-23-72" name="__codelineno-23-72" href="#__codelineno-23-72"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonguAArgs</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">uTimesA</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-23-73" name="__codelineno-23-73" href="#__codelineno-23-73"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alongvAArgs</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">lfArgs</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">vTimesA</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-23-74" name="__codelineno-23-74" href="#__codelineno-23-74"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonggraduTimesAArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">graduTimesA</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-23-75" name="__codelineno-23-75" href="#__codelineno-23-75"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">alonggradvTimesAArgs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">replaceAlong</span><span class="p">(</span><span class="n">argsForDyz</span><span class="p">,</span><span class="w"> </span><span class="n">along</span><span class="p">(</span><span class="n">gradvTimesA</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-23-76" name="__codelineno-23-76" href="#__codelineno-23-76"></a>
<a id="__codelineno-23-77" name="__codelineno-23-77" href="#__codelineno-23-77"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_xyzAlongv</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alongvAArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-78" name="__codelineno-23-78" href="#__codelineno-23-78"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonguAArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-79" name="__codelineno-23-79" href="#__codelineno-23-79"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">v_c0c1AlongGraduTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">r</span><span class="p">(),</span><span class="w"> </span><span class="n">alonggraduTimesAArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-80" name="__codelineno-23-80" href="#__codelineno-23-80"></a><span class="w">          </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">u_c0c1AlongGradvTimesA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">evaluateDerivativeImpl</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">l</span><span class="p">(),</span><span class="w"> </span><span class="n">alonggradvTimesAArgs</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-81" name="__codelineno-23-81" href="#__codelineno-23-81"></a><span class="w">          </span><span class="k">decltype</span><span class="p">(</span><span class="n">eval</span><span class="p">(</span><span class="n">u_xyzAlongv</span><span class="p">))</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-23-82" name="__codelineno-23-82" href="#__codelineno-23-82"></a>
<a id="__codelineno-23-83" name="__codelineno-23-83" href="#__codelineno-23-83"></a><span class="w">          </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u_xyzAlongv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_xyzAlongu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">v_c0c1AlongGraduTimesA</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">u_c0c1AlongGradvTimesA</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-23-84" name="__codelineno-23-84" href="#__codelineno-23-84"></a><span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">gridDim</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-23-85" name="__codelineno-23-85" href="#__codelineno-23-85"></a><span class="w">            </span><span class="n">res</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">u_c1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradv_c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_c1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradu_c0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">v_c0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradu_c1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-23-86" name="__codelineno-23-86" href="#__codelineno-23-86"></a><span class="w">                    </span><span class="o">+</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">u_c0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">gradv_c1</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w"> </span>
<a id="__codelineno-23-87" name="__codelineno-23-87" href="#__codelineno-23-87"></a><span class="w">                   </span><span class="o">*</span><span class="w"> </span><span class="n">alongMatrix</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-23-88" name="__codelineno-23-88" href="#__codelineno-23-88"></a>
<a id="__codelineno-23-89" name="__codelineno-23-89" href="#__codelineno-23-89"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-23-90" name="__codelineno-23-90" href="#__codelineno-23-90"></a>
<a id="__codelineno-23-91" name="__codelineno-23-91" href="#__codelineno-23-91"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span>
<a id="__codelineno-23-92" name="__codelineno-23-92" href="#__codelineno-23-92"></a><span class="w">      </span><span class="p">}</span><span class="w">  </span>
<a id="__codelineno-23-93" name="__codelineno-23-93" href="#__codelineno-23-93"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span>
</code></pre></div>
<ol>
<li>Compile time branch for first order derivatives</li>
<li>Evaluates the derivative of the <code>this-&gt;l()</code> wrt. the only derivative inside the localfunction arguments <code>lfArgs</code>.</li>
<li>Evaluates the return value and derivatives and function values are combined as dictated by the product rule.</li>
<li>Compile time branch for second order derivatives</li>
<li>Since we are in the second order derivatives branch, there are 4 case for the evaluation of function.<br />
   The function value, the function derivative wrt. to the first argument or the second and the function's derivatives wrt. to both arguments.
   Here, the function <code>evaluateFirstOrderDerivativesImpl</code> returns the derivatives wrt. to the first argument and the second.
   If we consider the left function as <span class="arithmatex">\(\boldsymbol{u}(\boldsymbol{\xi},\boldsymbol{u}_I)\)</span> this calls returns
   \begin{flalign*}<br />
   \verb+u_x+ &amp;= \frac{\partial\boldsymbol{u}}{\partial\boldsymbol{\xi}} \quad \text{or} \quad \verb+u_x+ = \frac{\partial\boldsymbol{u}}{\partial\xi_0} \quad \text{or} \quad \verb+u_x+ = \frac{\partial\boldsymbol{u}}{\partial\boldsymbol{u}_I}\\
   \verb+u_y+ &amp;= \frac{\partial\boldsymbol{u}}{\partial\boldsymbol{u}_J}
   \end{flalign*}
   The first one would be returned if the caller uses
   <div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div>
   and the second one
   <div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div>
   and the third without any spatial derivative using
   <div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div>
   Therefore, this function separates the two wrt. arguments and returns the corresponding first order derivatives.</li>
<li>Compile time branch for the case where no spatial derivatives are requested bot only wrt. coefficients is needed.</li>
<li>Creates a new argument variable where the along argument is replaced by <code>v</code>.</li>
<li>This function evaluates the derivatives of <code>l</code> wrt to both passed wrt arguments. Furthmore, it takes the give along argument since otherwise the returned object would be a 3 dimensional array.
   If we consider the left function as <span class="arithmatex">\(\boldsymbol{u}(\boldsymbol{\xi},\boldsymbol{u}_I)\)</span>  and <span class="arithmatex">\(\boldsymbol{v}\)</span> of the same size as <span class="arithmatex">\(\boldsymbol{u}\)</span> this calls returns
   \begin{flalign*}
   \verb+u_xyAlongv + &amp;= \frac{\partial^2 u_i }{\partial\boldsymbol{u}_I\partial\boldsymbol{u}_J} v_i
   \end{flalign*}
   This is the same if the user calls
   <div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span><span class="w"> </span>
</code></pre></div></li>
<li>Compile time branch for the case where one spatial derivatives and one derivative wrt. coefficients is needed.</li>
<li>This function evaluates the derivatives of <code>l</code> wrt to both passed wrt arguments.
    If we consider the left function as <span class="arithmatex">\(\boldsymbol{u}(\boldsymbol{\xi},\boldsymbol{u}_I)\)</span>  this calls returns
    \begin{flalign*}
    \verb+u_xy+ &amp;= \frac{\partial^2 \boldsymbol{u} }{\partial\boldsymbol{\xi}\partial\boldsymbol{u}_I} \quad \text{or} \quad \verb+u_xy+ = \frac{\partial^2 \boldsymbol{u} }{\partial\xi_0\partial\boldsymbol{u}_I}
    \end{flalign*}
    The first one would be returned if the caller uses
   <div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="w">    </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div>
and the second one
   <div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span><span class="w"> </span>
</code></pre></div>
In the first case the result is stored in an array. Thus in the first index the derivative wrt. to the first spatial coordinate is stored.
Therefore we would have in the code
   <div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">spatialAllCoeffDeriv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">)));</span><span class="w"> </span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">spatialAllCoeffDeriv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="c1">// derivative as in u.evaluateDerivative(gpIndex, wrt(spatial(0),coeff(i))); </span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="n">spatialAllCoeffDeriv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="c1">// derivative as in u.evaluateDerivative(gpIndex, wrt(spatial(1),coeff(i))); </span>
</code></pre></div></li>
<li>Compile time branch for the case where one single spatial derivatives and one derivative wrt. coefficients is needed.</li>
<li>Compile time branch for the case where all spatial derivatives and one derivative wrt. coefficients is needed.</li>
<li>The return type here is an array of single spatial derivatives and each derived wrt. the coefficient. Thus the type inside the array must be deduced here.</li>
<li>Compile time branch for third order derivatives</li>
<li>Compile time branch for single spatial derivatives</li>
<li>To obtain derivatives wrt to the second and third wrt argument we extract here the arguments. E.g. if we have the following request
   <div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
this call would extract the arguments as
   <div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="w"> </span><span class="n">newArgs</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="s">&quot;wrt(coeff(i,j)),along(matrix))&quot;</span><span class="w"> </span><span class="c1">//THIS IS NO VALID SYNTAX </span>
</code></pre></div>
This can be used then as
   <div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">newArgs</span><span class="p">);</span><span class="w"> </span>
</code></pre></div></li>
<li>As in the second order derivative case the returns all three first order derivatives. If we would have
    <div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
    The returned values would be
    \begin{flalign*}
    \verb+u_x+ &amp;= \frac{\partial \boldsymbol{u} }{\partial\boldsymbol{\xi}} \\
    \verb+u_y+ &amp;= \frac{\partial \boldsymbol{u} }{\partial\boldsymbol{u}_I} \\
    \verb+u_z+ &amp;= \frac{\partial \boldsymbol{u} }{\partial\boldsymbol{u}_J}<br />
    \end{flalign*}</li>
<li>This returns the derivatives wrt to the given spatial direction and wrt to the first and second coefficient.  If we would have
    <div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
    The returned values would be
    \begin{flalign*}
    \verb+u_xy+ &amp;= \frac{\partial^2 \boldsymbol{u} }{\partial\boldsymbol{\xi}\partial\boldsymbol{u}_I} \\
    \verb+u_xz+ &amp;= \frac{\partial^2 \boldsymbol{u} }{\partial\boldsymbol{\xi}\partial\boldsymbol{u}_J} \\
    \end{flalign*}</li>
<li>Creates a new argument variable where the along argument is replaced by <code>v_x</code>.</li>
<li>This return as the call would be
    <div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">along</span><span class="p">(</span><span class="n">v</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
    In mathematical notation this returns
    \begin{flalign*}
    \verb+u_xyzAlongv  + &amp;= \frac{\partial^3 u_i }{\partial \xi_0\partial\boldsymbol{u}_I\partial\boldsymbol{u}_J} v_i
    \end{flalign*}</li>
<li>This return as the call would be
    <div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="n">v_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatial</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span><span class="w"> </span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">u_yzAlongvx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">along</span><span class="p">(</span><span class="n">v_x</span><span class="p">));</span><span class="w"> </span>
</code></pre></div>
    In mathematical notation this returns
    \begin{flalign*}
    \verb+u_yzAlongvx+ &amp;= \frac{\partial^2 u_i }{\partial\boldsymbol{u}_I\partial\boldsymbol{u}_J} \left[\frac{\partial \boldsymbol{v}}{\xi_0}\right]_i
    \end{flalign*}</li>
<li>Compile time branch for all spatial derivatives</li>
<li>Obtain the along argument give by the caller as in
    <div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">u</span><span class="p">.</span><span class="n">evaluateDerivative</span><span class="p">(</span><span class="n">gpIndex</span><span class="p">,</span><span class="w"> </span><span class="n">wrt</span><span class="p">(</span><span class="n">spatialAll</span><span class="p">,</span><span class="n">coeff</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">along</span><span class="p">(</span><span class="n">matrix</span><span class="p">));</span><span class="w"> </span>
</code></pre></div></li>
<li>As above in the single spatial case</li>
<li>As above in the single spatial case</li>
</ol>
<p>If your expression is working you should add it to <code>ikarus/localfunctions/expressions.hh</code></p>
<div class="footnote">
<hr />
<ol>
<li id="fn:et">
<p><a href="https://de.wikipedia.org/wiki/Expression_Templates">Expression templates</a> are usually used in linear algebra libraries, e.g. <a href="https://eigen.tuxfamily.org">Eigen</a> or <a href="https://bitbucket.org/blaze-lib/blaze/src/master/">Blaze</a>.
The syntax is similar to the one provided by <a href="https://fenics.readthedocs.io/projects/ufl/en/latest/manual/form_language.html">UML</a> but only acts on local functions.&#160;<a class="footnote-backref" href="#fnref:et" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:1">
<p>Oliver Sander. <em>DUNEThe Distributed and Unified Numerics Environment</em>. Volume 140. Springer Nature, 2020. URL: <a href="https://link.springer.com/book/10.1007/978-3-030-59702-3">https://link.springer.com/book/10.1007/978-3-030-59702-3</a>.&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p>Philipp Grohs, Hanne Hardering, Oliver Sander, and Markus Sprecher. Projection-based finite elements for nonlinear function spaces. <em>SIAM J Numer Anal</em>, 57(1):404&ndash;428, 2019. <a href="https://doi.org/10.1137/18M1176798">doi:10.1137/18M1176798</a>.&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
</ol>
</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../localBasis/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Local basis" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Local basis
            </div>
          </div>
        </a>
      
      
        
        <a href="../manifolds/" class="md-footer__link md-footer__link--next" aria-label="Next: Manifolds" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Manifolds
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 The Ikarus Developers
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>